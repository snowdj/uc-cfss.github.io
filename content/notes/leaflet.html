---
title: "Drawing interactive maps with Leaflet"
date: 2019-03-01

type: docs
draft: false
aliases: ["/geoviz_leaflet.html"]
categories: ["dataviz", "geospatial"]

menu:
  notes:
    parent: Geospatial visualization
    weight: 6
---

<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/pymjs/pym.v1.js"></script>
<script src="/rmarkdown-libs/widgetframe-binding/widgetframe.js"></script>
<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<div id="TOC">
<ul>
<li><a href="#basic-usage"><span class="toc-section-number">0.1</span> Basic usage</a></li>
<li><a href="#basemaps"><span class="toc-section-number">0.2</span> Basemaps</a></li>
<li><a href="#add-markers"><span class="toc-section-number">0.3</span> Add markers</a></li>
<li><a href="#add-labels-and-popups"><span class="toc-section-number">0.4</span> Add labels and popups</a></li>
<li><a href="#add-lines-and-shapes"><span class="toc-section-number">0.5</span> Add lines and shapes</a></li>
<li><a href="#choropleth-of-homicides-by-neighborhood"><span class="toc-section-number">0.6</span> Choropleth of homicides by neighborhood</a></li>
<li><a href="#add-color"><span class="toc-section-number">0.7</span> Add color</a></li>
<li><a href="#custom-information"><span class="toc-section-number">0.8</span> Custom information</a></li>
<li><a href="#add-legend"><span class="toc-section-number">0.9</span> Add legend</a></li>
<li><a href="#session-info"><span class="toc-section-number">0.10</span> Session Info</a></li>
</ul>
</div>

<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">library</span>(leaflet)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">library</span>(stringr)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw">library</span>(sf)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="kw">library</span>(here)</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="kw">library</span>(widgetframe)</span>
<span id="cb1-7"><a href="#cb1-7"></a></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="kw">options</span>(<span class="dt">digits =</span> <span class="dv">3</span>)</span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="kw">theme_set</span>(<span class="kw">theme_minimal</span>())</span></code></pre></div>
<p><a href="https://leafletjs.com/">Leaflet</a> is an open-source JavaScript library for creating interactive maps. Unlike static visualization packages such as <code>ggplot2</code> or <code>ggmap</code>, Leaflet maps are fully interactive and can include features such as:</p>
<ul>
<li>Interactive panning/zooming</li>
<li>Pop-up tooltips and labels</li>
<li>Highlighting/selecting regions</li>
</ul>
<p>It is used by many news organizations and tech websites to visualize geographic data. The <code>leaflet</code> package for R enables the creation of interactive maps within R without learning how to write JavaScript code. The <a href="https://rstudio.github.io/leaflet/"><code>leaflet</code> documentation</a> is a handy walkthrough for the basics of creating Leaflet maps in R. Let’s explore here how to create Leaflet maps using the same data we used to create <a href="/notes/raster-maps-with-ggmap/">raster maps with <code>ggmap</code></a>, <a href="https://data.cityofchicago.org/Public-Safety/Crimes-2017/d62x-nvdr">crime data from the city of Chicago in 2017</a>.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>crimes &lt;-<span class="st"> </span><span class="kw">here</span>(<span class="st">&quot;static&quot;</span>, <span class="st">&quot;data&quot;</span>, <span class="st">&quot;Crimes_-_2017.csv&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="st">  </span><span class="kw">read_csv</span>()</span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="kw">glimpse</span>(crimes)</span></code></pre></div>
<pre><code>## Observations: 267,345
## Variables: 22
## $ ID                     &lt;dbl&gt; 11094370, 11118031, 11134189, 11156462, 1…
## $ `Case Number`          &lt;chr&gt; &quot;JA440032&quot;, &quot;JA470589&quot;, &quot;JA491697&quot;, &quot;JA52…
## $ Date                   &lt;chr&gt; &quot;09/21/2017 12:15:00 AM&quot;, &quot;10/12/2017 07:…
## $ Block                  &lt;chr&gt; &quot;072XX N CALIFORNIA AVE&quot;, &quot;055XX W GRAND …
## $ IUCR                   &lt;chr&gt; &quot;1122&quot;, &quot;1345&quot;, &quot;4651&quot;, &quot;1110&quot;, &quot;0265&quot;, &quot;…
## $ `Primary Type`         &lt;chr&gt; &quot;DECEPTIVE PRACTICE&quot;, &quot;CRIMINAL DAMAGE&quot;, …
## $ Description            &lt;chr&gt; &quot;COUNTERFEIT CHECK&quot;, &quot;TO CITY OF CHICAGO …
## $ `Location Description` &lt;chr&gt; &quot;CURRENCY EXCHANGE&quot;, &quot;JAIL / LOCK-UP FACI…
## $ Arrest                 &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE,…
## $ Domestic               &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE,…
## $ Beat                   &lt;chr&gt; &quot;2411&quot;, &quot;2515&quot;, &quot;0922&quot;, &quot;2514&quot;, &quot;1221&quot;, &quot;…
## $ District               &lt;chr&gt; &quot;024&quot;, &quot;025&quot;, &quot;009&quot;, &quot;025&quot;, &quot;012&quot;, &quot;002&quot;,…
## $ Ward                   &lt;dbl&gt; 50, 29, 12, 30, 32, 20, 9, 12, 12, 27, 32…
## $ `Community Area`       &lt;dbl&gt; 2, 19, 58, 19, 24, 40, 49, 30, 30, 23, 24…
## $ `FBI Code`             &lt;chr&gt; &quot;10&quot;, &quot;14&quot;, &quot;26&quot;, &quot;11&quot;, &quot;02&quot;, &quot;15&quot;, &quot;03&quot;,…
## $ `X Coordinate`         &lt;dbl&gt; 1156443, 1138788, 1159425, 1138653, 11612…
## $ `Y Coordinate`         &lt;dbl&gt; 1947707, 1913480, 1875711, 1920720, 19052…
## $ Year                   &lt;dbl&gt; 2017, 2017, 2017, 2017, 2017, 2017, 2017,…
## $ `Updated On`           &lt;chr&gt; &quot;03/01/2018 03:52:35 PM&quot;, &quot;03/01/2018 03:…
## $ Latitude               &lt;dbl&gt; 42.0, 41.9, 41.8, 41.9, 41.9, 41.8, 41.7,…
## $ Longitude              &lt;dbl&gt; -87.7, -87.8, -87.7, -87.8, -87.7, -87.6,…
## $ Location               &lt;chr&gt; &quot;(42.012293397, -87.699714109)&quot;, &quot;(41.918…</code></pre>
<div id="basic-usage" class="section level2">
<h2><span class="header-section-number">0.1</span> Basic usage</h2>
<p>Leaflet maps are built using layers, similar to <code>ggplot2</code>.</p>
<ol style="list-style-type: decimal">
<li>Create a map widget by calling <code>leaflet()</code></li>
<li>Add <strong>layers</strong> to the map using one or more of the layer functions (e.g. <code>addTiles()</code>, <code>addMarkers()</code>, <code>addPolygons()</code>)</li>
<li>Repeat step 2 as many times as necessary to incorporate the necessary information</li>
<li>Display the map widget</li>
</ol>
<p>A basic example is:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>m &lt;-<span class="st"> </span><span class="kw">leaflet</span>() <span class="op">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="st">  </span><span class="kw">addTiles</span>() <span class="op">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="st">  </span><span class="kw">addMarkers</span>(<span class="dt">lng =</span> <span class="fl">-87.597241</span>, <span class="dt">lat =</span> <span class="fl">41.789829</span>,</span>
<span id="cb4-4"><a href="#cb4-4"></a>             <span class="dt">popup =</span> <span class="st">&quot;Saieh Hall of Economics&quot;</span>)</span>
<span id="cb4-5"><a href="#cb4-5"></a>m <span class="op">%&gt;%</span></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="st">  </span><span class="kw">frameWidget</span>()</span></code></pre></div>
<div id="htmlwidget-1" style="width:100%;height:480px;" class="widgetframe html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"url":"/notes/leaflet_files/figure-html//widgets/widget_leaflet-basic.html","options":{"xdomain":"*","allowfullscreen":false,"lazyload":false}},"evals":[],"jsHooks":[]}</script>
<p>{{% alert warning %}}</p>
<p>Note: you do not need to use <code>frameWidget()</code> to view the output of each map in RStudio. I only use it here because it is necessary based on the publishing package used to construct the website.</p>
<p>{{% /alert %}}</p>
</div>
<div id="basemaps" class="section level2">
<h2><span class="header-section-number">0.2</span> Basemaps</h2>
<p>Like <code>ggmap</code>, <code>leaflet</code> supports basemaps using map tiles. By default, OpenStreetMap tiles are used.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>m &lt;-<span class="st"> </span><span class="kw">leaflet</span>() <span class="op">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="st">  </span><span class="kw">setView</span>(<span class="dt">lng =</span> <span class="fl">-87.618994</span>, <span class="dt">lat =</span> <span class="fl">41.875619</span>, <span class="dt">zoom =</span> <span class="dv">12</span>)</span>
<span id="cb5-3"><a href="#cb5-3"></a>m <span class="op">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="st">  </span><span class="kw">addTiles</span>() <span class="op">%&gt;%</span></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="st">  </span><span class="kw">frameWidget</span>()</span></code></pre></div>
<div id="htmlwidget-2" style="width:100%;height:480px;" class="widgetframe html-widget"></div>
<script type="application/json" data-for="htmlwidget-2">{"x":{"url":"/notes/leaflet_files/figure-html//widgets/widget_basemap.html","options":{"xdomain":"*","allowfullscreen":false,"lazyload":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="add-markers" class="section level2">
<h2><span class="header-section-number">0.3</span> Add markers</h2>
<p><strong>Markers</strong> are used to identify points on the map. Each point needs to be defined in terms of latitude/longitude coordinates. These can come from a variety of sources, most commonly either a <a href="/notes/simple-features/">map data file</a> such as a shapefile or GeoJSON (imported using <code>sf</code>) or a data frame with latitude and longitude columns.</p>
<p>Let’s use the Chicago crimes data to draw a map of the city identifying the location of each reported homicide:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>(homicides &lt;-<span class="st"> </span>crimes <span class="op">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="st">  </span><span class="kw">filter</span>(<span class="st">`</span><span class="dt">Primary Type</span><span class="st">`</span> <span class="op">==</span><span class="st"> &quot;HOMICIDE&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 671 x 22
##        ID `Case Number` Date  Block IUCR  `Primary Type` Description
##     &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;          &lt;chr&gt;      
##  1 2.31e4 JA149608      02/1… 001X… 0110  HOMICIDE       FIRST DEGR…
##  2 2.39e4 JA530946      11/3… 088X… 0110  HOMICIDE       FIRST DEGR…
##  3 2.34e4 JA302423      06/1… 047X… 0110  HOMICIDE       FIRST DEGR…
##  4 2.34e4 JA312425      06/1… 006X… 0110  HOMICIDE       FIRST DEGR…
##  5 2.37e4 JA490016      10/2… 048X… 0110  HOMICIDE       FIRST DEGR…
##  6 2.32e4 JA210752      04/0… 013X… 0110  HOMICIDE       FIRST DEGR…
##  7 2.36e4 JA461918      10/0… 018X… 0110  HOMICIDE       FIRST DEGR…
##  8 2.36e4 JA461918      10/0… 018X… 0110  HOMICIDE       FIRST DEGR…
##  9 1.08e7 JA138326      02/0… 013X… 0142  HOMICIDE       RECKLESS H…
## 10 2.35e4 JA364517      07/2… 047X… 0110  HOMICIDE       FIRST DEGR…
## # … with 661 more rows, and 15 more variables: `Location
## #   Description` &lt;chr&gt;, Arrest &lt;lgl&gt;, Domestic &lt;lgl&gt;, Beat &lt;chr&gt;,
## #   District &lt;chr&gt;, Ward &lt;dbl&gt;, `Community Area` &lt;dbl&gt;, `FBI Code` &lt;chr&gt;,
## #   `X Coordinate` &lt;dbl&gt;, `Y Coordinate` &lt;dbl&gt;, Year &lt;dbl&gt;, `Updated
## #   On` &lt;chr&gt;, Latitude &lt;dbl&gt;, Longitude &lt;dbl&gt;, Location &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw">leaflet</span>(<span class="dt">data =</span> homicides) <span class="op">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="st">  </span><span class="kw">addTiles</span>() <span class="op">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="st">  </span><span class="kw">addMarkers</span>() <span class="op">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="st">  </span><span class="kw">frameWidget</span>()</span></code></pre></div>
<div id="htmlwidget-3" style="width:100%;height:480px;" class="widgetframe html-widget"></div>
<script type="application/json" data-for="htmlwidget-3">{"x":{"url":"/notes/leaflet_files/figure-html//widgets/widget_homicide-map.html","options":{"xdomain":"*","allowfullscreen":false,"lazyload":false}},"evals":[],"jsHooks":[]}</script>
<p>{{% alert note %}}</p>
<p><code>addMarkers()</code> and related functions will automatically check data frames for columns called <code>lng</code>/<code>long</code>/<code>longitude</code> and <code>lat</code>/<code>latitude</code> (case-insensitively). If your coordinate columns have any other names, you need to explicitly identify them using the <code>lng</code> and <code>lat</code> arguments. Such as `addMarkers(lng = ~Longitude, lat = ~Latitude).</p>
<p>{{% /alert %}}</p>
<p>Without any customization, we get a basic map with each murder location indicated by a dropped pin. Each markers appearance can be customized, though the technical difficulty quickly ramps up. The <a href="https://github.com/lvoogdt/Leaflet.awesome-markers">awesome markers</a> plugin offers the most straight-forward customizability options. Instead of using <code>addMarkers()</code>, use <code>addAwesomeMarkers()</code> to control the appearance of the markers using icons from the <a href="http://fontawesome.io/icons/">Font Awesome</a>, <a href="https://getbootstrap.com/components/">Bootstrap Glyphicons</a>, and <a href="http://ionicons.com/">Ion icons</a> icon libraries. First you define the appearance of the icon using <code>awesomeIcons()</code>, then pass that as an argument to <code>addAwesomeMarkers()</code>:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>icons &lt;-<span class="st"> </span><span class="kw">awesomeIcons</span>(</span>
<span id="cb9-2"><a href="#cb9-2"></a>  <span class="dt">icon =</span> <span class="st">&#39;bolt&#39;</span>,</span>
<span id="cb9-3"><a href="#cb9-3"></a>  <span class="dt">iconColor =</span> <span class="st">&#39;orange&#39;</span>,</span>
<span id="cb9-4"><a href="#cb9-4"></a>  <span class="dt">markerColor =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb9-5"><a href="#cb9-5"></a>  <span class="dt">library =</span> <span class="st">&#39;fa&#39;</span></span>
<span id="cb9-6"><a href="#cb9-6"></a>)</span>
<span id="cb9-7"><a href="#cb9-7"></a></span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="kw">leaflet</span>(<span class="dt">data =</span> homicides) <span class="op">%&gt;%</span></span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="st">  </span><span class="kw">addTiles</span>() <span class="op">%&gt;%</span></span>
<span id="cb9-10"><a href="#cb9-10"></a><span class="st">  </span><span class="kw">addAwesomeMarkers</span>(<span class="dt">icon =</span> icons) <span class="op">%&gt;%</span></span>
<span id="cb9-11"><a href="#cb9-11"></a><span class="st">  </span><span class="kw">frameWidget</span>()</span></code></pre></div>
<div id="htmlwidget-4" style="width:100%;height:480px;" class="widgetframe html-widget"></div>
<script type="application/json" data-for="htmlwidget-4">{"x":{"url":"/notes/leaflet_files/figure-html//widgets/widget_homicide-map-icons.html","options":{"xdomain":"*","allowfullscreen":false,"lazyload":false}},"evals":[],"jsHooks":[]}</script>
<p>One concern is that some neighborhoods have so many murders that the points overlap. One solution enabled by Leaflet’s interactivity is to <strong>cluster</strong> markers at varying levels of detail using the <code>clusterOptions</code> argument to <code>addMarkers()</code>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="kw">leaflet</span>(<span class="dt">data =</span> homicides) <span class="op">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="st">  </span><span class="kw">addTiles</span>() <span class="op">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="st">  </span><span class="kw">addMarkers</span>(<span class="dt">clusterOptions =</span> <span class="kw">markerClusterOptions</span>()) <span class="op">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="st">  </span><span class="kw">frameWidget</span>()</span></code></pre></div>
<div id="htmlwidget-5" style="width:100%;height:480px;" class="widgetframe html-widget"></div>
<script type="application/json" data-for="htmlwidget-5">{"x":{"url":"/notes/leaflet_files/figure-html//widgets/widget_homicide-map-cluster.html","options":{"xdomain":"*","allowfullscreen":false,"lazyload":false}},"evals":[],"jsHooks":[]}</script>
<p>Alternatively, we could use circles using <code>addCircleMarkers()</code>:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw">leaflet</span>(<span class="dt">data =</span> homicides) <span class="op">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="st">  </span><span class="kw">addTiles</span>() <span class="op">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="st">  </span><span class="kw">addCircleMarkers</span>() <span class="op">%&gt;%</span></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="st">  </span><span class="kw">frameWidget</span>()</span></code></pre></div>
<div id="htmlwidget-6" style="width:100%;height:480px;" class="widgetframe html-widget"></div>
<script type="application/json" data-for="htmlwidget-6">{"x":{"url":"/notes/leaflet_files/figure-html//widgets/widget_homicide-map-circles.html","options":{"xdomain":"*","allowfullscreen":false,"lazyload":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="add-labels-and-popups" class="section level2">
<h2><span class="header-section-number">0.4</span> Add labels and popups</h2>
<p>Each point can have text added to it using either a <strong>label</strong> (appears either on hover or statically) or a popup (appears only on click). For instance we can label each murder with the date/timestamp when it was originally reported.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="kw">leaflet</span>(<span class="dt">data =</span> homicides) <span class="op">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="st">  </span><span class="kw">addTiles</span>() <span class="op">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="st">  </span><span class="kw">addMarkers</span>(<span class="dt">label =</span> <span class="op">~</span>Date) <span class="op">%&gt;%</span></span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="st">  </span><span class="kw">frameWidget</span>()</span></code></pre></div>
<div id="htmlwidget-7" style="width:100%;height:480px;" class="widgetframe html-widget"></div>
<script type="application/json" data-for="htmlwidget-7">{"x":{"url":"/notes/leaflet_files/figure-html//widgets/widget_homicide-map-label.html","options":{"xdomain":"*","allowfullscreen":false,"lazyload":false}},"evals":[],"jsHooks":[]}</script>
<p>If we only want the information to appear when we click on the point, we should instead use <code>popup = ~Date</code>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="kw">leaflet</span>(<span class="dt">data =</span> homicides) <span class="op">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="st">  </span><span class="kw">addTiles</span>() <span class="op">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="st">  </span><span class="kw">addMarkers</span>(<span class="dt">popup =</span> <span class="op">~</span>Date) <span class="op">%&gt;%</span></span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="st">  </span><span class="kw">frameWidget</span>()</span></code></pre></div>
<div id="htmlwidget-8" style="width:100%;height:480px;" class="widgetframe html-widget"></div>
<script type="application/json" data-for="htmlwidget-8">{"x":{"url":"/notes/leaflet_files/figure-html//widgets/widget_homicide-map-popups.html","options":{"xdomain":"*","allowfullscreen":false,"lazyload":false}},"evals":[],"jsHooks":[]}</script>
<p>We can combine multiple pieces of information to create a custom popup message. Unfortunately this does require <a href="https://websitesetup.org/html5-cheat-sheet/">basic knowledge of writing HTML documents</a>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>homicides <span class="op">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">popup =</span> <span class="kw">str_c</span>(Date,</span>
<span id="cb14-3"><a href="#cb14-3"></a>                       Block,</span>
<span id="cb14-4"><a href="#cb14-4"></a>                       <span class="kw">str_c</span>(<span class="st">&quot;Location type:&quot;</span>, <span class="st">`</span><span class="dt">Location Description</span><span class="st">`</span>,</span>
<span id="cb14-5"><a href="#cb14-5"></a>                             <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>),</span>
<span id="cb14-6"><a href="#cb14-6"></a>                       <span class="dt">sep =</span> <span class="st">&quot;&lt;br/&gt;&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="st">  </span><span class="kw">leaflet</span>() <span class="op">%&gt;%</span></span>
<span id="cb14-8"><a href="#cb14-8"></a><span class="st">  </span><span class="kw">addTiles</span>() <span class="op">%&gt;%</span></span>
<span id="cb14-9"><a href="#cb14-9"></a><span class="st">  </span><span class="kw">addMarkers</span>(<span class="dt">popup =</span> <span class="op">~</span>popup) <span class="op">%&gt;%</span></span>
<span id="cb14-10"><a href="#cb14-10"></a><span class="st">  </span><span class="kw">frameWidget</span>()</span></code></pre></div>
<div id="htmlwidget-9" style="width:100%;height:480px;" class="widgetframe html-widget"></div>
<script type="application/json" data-for="htmlwidget-9">{"x":{"url":"/notes/leaflet_files/figure-html//widgets/widget_homicide-map-popups-long.html","options":{"xdomain":"*","allowfullscreen":false,"lazyload":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="add-lines-and-shapes" class="section level2">
<h2><span class="header-section-number">0.5</span> Add lines and shapes</h2>
<p>Leaflet can also draw spatial lines and shapes from R and add them to maps. Given our previous exposure to <code>sf</code> and importing shapefiles using <code>st_read()</code>, let draw a map of Chicago with each community area outlined.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>areas &lt;-<span class="st"> </span><span class="kw">here</span>(<span class="st">&quot;static&quot;</span>, <span class="st">&quot;data&quot;</span>,</span>
<span id="cb15-2"><a href="#cb15-2"></a>              <span class="st">&quot;Boundaries - Community Areas (current)&quot;</span>,</span>
<span id="cb15-3"><a href="#cb15-3"></a>              <span class="st">&quot;geo_export_328cdcbf-33ba-4997-8ce8-90953c6fec19.shp&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="st">  </span><span class="kw">st_read</span>() <span class="op">%&gt;%</span></span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="st">  </span><span class="co"># convert community names to title case</span></span>
<span id="cb15-6"><a href="#cb15-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">community =</span> <span class="kw">str_to_title</span>(community))</span></code></pre></div>
<pre><code>## Reading layer `geo_export_328cdcbf-33ba-4997-8ce8-90953c6fec19&#39; from data source `/Users/soltoffbc/Projects/Computing for Social Sciences/course-site/static/data/Boundaries - Community Areas (current)/geo_export_328cdcbf-33ba-4997-8ce8-90953c6fec19.shp&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 77 features and 9 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: -87.9 ymin: 41.6 xmax: -87.5 ymax: 42
## epsg (SRID):    4326
## proj4string:    +proj=longlat +ellps=WGS84 +no_defs</code></pre>
<p>To do this in <code>ggplot()</code>, we only need two lines of code:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> areas) <span class="op">+</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="st">  </span><span class="kw">geom_sf</span>()</span></code></pre></div>
<p><img src="/notes/leaflet_files/figure-html/community-areas-ggplot-1.png" width="672" /></p>
<p>To draw this in <code>leaflet</code>, we use <code>addPolygons()</code>:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="kw">leaflet</span>(<span class="dt">data =</span> areas) <span class="op">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="st">  </span><span class="kw">addPolygons</span>(<span class="dt">color =</span> <span class="st">&quot;#444444&quot;</span>,</span>
<span id="cb18-3"><a href="#cb18-3"></a>              <span class="dt">weight =</span> <span class="dv">1</span>,</span>
<span id="cb18-4"><a href="#cb18-4"></a>              <span class="dt">smoothFactor =</span> <span class="fl">0.5</span>,</span>
<span id="cb18-5"><a href="#cb18-5"></a>              <span class="dt">opacity =</span> <span class="fl">1.0</span>,</span>
<span id="cb18-6"><a href="#cb18-6"></a>              <span class="dt">fillOpacity =</span> <span class="fl">0.5</span>,</span>
<span id="cb18-7"><a href="#cb18-7"></a>              <span class="dt">highlightOptions =</span> <span class="kw">highlightOptions</span>(<span class="dt">color =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb18-8"><a href="#cb18-8"></a>                                                  <span class="dt">weight =</span> <span class="dv">2</span>,</span>
<span id="cb18-9"><a href="#cb18-9"></a>                                                  <span class="dt">bringToFront =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></span>
<span id="cb18-10"><a href="#cb18-10"></a><span class="st">  </span><span class="kw">frameWidget</span>()</span></code></pre></div>
<div id="htmlwidget-10" style="width:100%;height:480px;" class="widgetframe html-widget"></div>
<script type="application/json" data-for="htmlwidget-10">{"x":{"url":"/notes/leaflet_files/figure-html//widgets/widget_community-areas-leaflet.html","options":{"xdomain":"*","allowfullscreen":false,"lazyload":false}},"evals":[],"jsHooks":[]}</script>
<p>The first several arguments adjust the appearance of each polygon region (e.g. color, opacity, border thickness). <code>highlightOptions</code> emphasizes the currently moused-over polygon. We can further add detail to this map by labeling each community area just as we did with points:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="kw">leaflet</span>(<span class="dt">data =</span> areas) <span class="op">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="st">  </span><span class="kw">addPolygons</span>(<span class="dt">label =</span> <span class="op">~</span>community,</span>
<span id="cb19-3"><a href="#cb19-3"></a>              <span class="dt">color =</span> <span class="st">&quot;#444444&quot;</span>,</span>
<span id="cb19-4"><a href="#cb19-4"></a>              <span class="dt">weight =</span> <span class="dv">1</span>,</span>
<span id="cb19-5"><a href="#cb19-5"></a>              <span class="dt">smoothFactor =</span> <span class="fl">0.5</span>,</span>
<span id="cb19-6"><a href="#cb19-6"></a>              <span class="dt">opacity =</span> <span class="fl">1.0</span>,</span>
<span id="cb19-7"><a href="#cb19-7"></a>              <span class="dt">fillOpacity =</span> <span class="fl">0.5</span>,</span>
<span id="cb19-8"><a href="#cb19-8"></a>              <span class="dt">highlightOptions =</span> <span class="kw">highlightOptions</span>(<span class="dt">color =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb19-9"><a href="#cb19-9"></a>                                                  <span class="dt">weight =</span> <span class="dv">2</span>,</span>
<span id="cb19-10"><a href="#cb19-10"></a>                                                  <span class="dt">bringToFront =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></span>
<span id="cb19-11"><a href="#cb19-11"></a><span class="st">  </span><span class="kw">frameWidget</span>()</span></code></pre></div>
<div id="htmlwidget-11" style="width:100%;height:480px;" class="widgetframe html-widget"></div>
<script type="application/json" data-for="htmlwidget-11">{"x":{"url":"/notes/leaflet_files/figure-html//widgets/widget_community-areas-label.html","options":{"xdomain":"*","allowfullscreen":false,"lazyload":false}},"evals":[],"jsHooks":[]}</script>
<p>And since <code>leaflet</code> map widgets are built in layers, we can overlay the community areas on top of a standard map of the city.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="kw">leaflet</span>(<span class="dt">data =</span> areas) <span class="op">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="st">  </span><span class="kw">addTiles</span>() <span class="op">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3"></a><span class="st">  </span><span class="kw">addPolygons</span>(<span class="dt">label =</span> <span class="op">~</span>community,</span>
<span id="cb20-4"><a href="#cb20-4"></a>              <span class="dt">color =</span> <span class="st">&quot;#444444&quot;</span>,</span>
<span id="cb20-5"><a href="#cb20-5"></a>              <span class="dt">weight =</span> <span class="dv">1</span>,</span>
<span id="cb20-6"><a href="#cb20-6"></a>              <span class="dt">smoothFactor =</span> <span class="fl">0.5</span>,</span>
<span id="cb20-7"><a href="#cb20-7"></a>              <span class="dt">opacity =</span> <span class="fl">1.0</span>,</span>
<span id="cb20-8"><a href="#cb20-8"></a>              <span class="dt">fillOpacity =</span> <span class="fl">0.5</span>,</span>
<span id="cb20-9"><a href="#cb20-9"></a>              <span class="dt">highlightOptions =</span> <span class="kw">highlightOptions</span>(<span class="dt">color =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb20-10"><a href="#cb20-10"></a>                                                  <span class="dt">weight =</span> <span class="dv">2</span>,</span>
<span id="cb20-11"><a href="#cb20-11"></a>                                                  <span class="dt">bringToFront =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></span>
<span id="cb20-12"><a href="#cb20-12"></a><span class="st">  </span><span class="kw">frameWidget</span>()</span></code></pre></div>
<div id="htmlwidget-12" style="width:100%;height:480px;" class="widgetframe html-widget"></div>
<script type="application/json" data-for="htmlwidget-12">{"x":{"url":"/notes/leaflet_files/figure-html//widgets/widget_community-areas-overlay.html","options":{"xdomain":"*","allowfullscreen":false,"lazyload":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="choropleth-of-homicides-by-neighborhood" class="section level2">
<h2><span class="header-section-number">0.6</span> Choropleth of homicides by neighborhood</h2>
<p>Now that we have a basic map of the city of Chicago with each community area identified, we can turn this map into a choropleth by filling in the color of each community area based on the number of reported homicides in 2017. First we calculate the total number of reported homicides by community area and merge this with the simple features data frame:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>(areas_homicides &lt;-<span class="st"> </span>areas <span class="op">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="st">   </span><span class="kw">select</span>(community, area_numbe) <span class="op">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3"></a><span class="st">   </span><span class="kw">mutate</span>(<span class="dt">area_numbe =</span> <span class="kw">as.numeric</span>(<span class="kw">as.character</span>(area_numbe))) <span class="op">%&gt;%</span></span>
<span id="cb21-4"><a href="#cb21-4"></a><span class="st">   </span><span class="kw">left_join</span>(homicides <span class="op">%&gt;%</span></span>
<span id="cb21-5"><a href="#cb21-5"></a><span class="st">               </span><span class="kw">count</span>(<span class="st">`</span><span class="dt">Community Area</span><span class="st">`</span>),</span>
<span id="cb21-6"><a href="#cb21-6"></a>             <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;area_numbe&quot;</span> =<span class="st"> &quot;Community Area&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb21-7"><a href="#cb21-7"></a><span class="st">   </span><span class="kw">mutate</span>(<span class="dt">n =</span> <span class="kw">ifelse</span>(<span class="kw">is.na</span>(n), <span class="dv">0</span>, n)))</span></code></pre></div>
<pre><code>## Simple feature collection with 77 features and 3 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: -87.9 ymin: 41.6 xmax: -87.5 ymax: 42
## epsg (SRID):    4326
## proj4string:    +proj=longlat +ellps=WGS84 +no_defs
## First 10 features:
##          community area_numbe  n                       geometry
## 1          Douglas         35  3 MULTIPOLYGON (((-87.6 41.8,...
## 2          Oakland         36  0 MULTIPOLYGON (((-87.6 41.8,...
## 3      Fuller Park         37  2 MULTIPOLYGON (((-87.6 41.8,...
## 4  Grand Boulevard         38 10 MULTIPOLYGON (((-87.6 41.8,...
## 5          Kenwood         39  4 MULTIPOLYGON (((-87.6 41.8,...
## 6   Lincoln Square          4  1 MULTIPOLYGON (((-87.7 42, -...
## 7  Washington Park         40 12 MULTIPOLYGON (((-87.6 41.8,...
## 8        Hyde Park         41  1 MULTIPOLYGON (((-87.6 41.8,...
## 9         Woodlawn         42 14 MULTIPOLYGON (((-87.6 41.8,...
## 10     Rogers Park          1  4 MULTIPOLYGON (((-87.7 42, -...</code></pre>
</div>
<div id="add-color" class="section level2">
<h2><span class="header-section-number">0.7</span> Add color</h2>
<p>Next we need to define the <a href="geoviz_color.html">color palette</a> for this map. <code>leaflet</code> has <a href="https://rstudio.github.io/leaflet/colors.html">its own series of functions to generate palettes</a> using either <code>RColorBrewer</code> or <code>viridis</code>.</p>
<p>First, we define the bins. This is a numeric vector that defines the boundaries between intervals (<code>(0,10]</code>, <code>(10,20]</code>, and so on).</p>
<p>Then, we call <code>colorBin()</code> to generate a palette function that maps the <code>RColorBrewer</code> <code>"YlOrRd"</code> palette to our bins.</p>
<p>Finally, we modify <code>addPolygons()</code> to use the palette function and the density values to generate a vector of colors for <code>fillColor()</code>, and also add some other static style properties.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>bins &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">50</span>, <span class="ot">Inf</span>)</span>
<span id="cb23-2"><a href="#cb23-2"></a>pal &lt;-<span class="st"> </span><span class="kw">colorBin</span>(<span class="st">&quot;YlOrRd&quot;</span>, <span class="dt">domain =</span> areas_homicides<span class="op">$</span>n, <span class="dt">bins =</span> bins)</span>
<span id="cb23-3"><a href="#cb23-3"></a></span>
<span id="cb23-4"><a href="#cb23-4"></a>areas_homicides <span class="op">%&gt;%</span></span>
<span id="cb23-5"><a href="#cb23-5"></a><span class="st">  </span><span class="kw">leaflet</span>() <span class="op">%&gt;%</span></span>
<span id="cb23-6"><a href="#cb23-6"></a><span class="st">  </span><span class="kw">addTiles</span>() <span class="op">%&gt;%</span></span>
<span id="cb23-7"><a href="#cb23-7"></a><span class="st">  </span><span class="kw">addPolygons</span>(<span class="dt">label =</span> <span class="op">~</span>community,</span>
<span id="cb23-8"><a href="#cb23-8"></a>              <span class="dt">fillColor =</span> <span class="op">~</span><span class="kw">pal</span>(n),</span>
<span id="cb23-9"><a href="#cb23-9"></a>              <span class="dt">color =</span> <span class="st">&quot;#444444&quot;</span>,</span>
<span id="cb23-10"><a href="#cb23-10"></a>              <span class="dt">weight =</span> <span class="dv">1</span>,</span>
<span id="cb23-11"><a href="#cb23-11"></a>              <span class="dt">smoothFactor =</span> <span class="fl">0.5</span>,</span>
<span id="cb23-12"><a href="#cb23-12"></a>              <span class="dt">opacity =</span> <span class="fl">1.0</span>,</span>
<span id="cb23-13"><a href="#cb23-13"></a>              <span class="dt">fillOpacity =</span> <span class="fl">0.5</span>,</span>
<span id="cb23-14"><a href="#cb23-14"></a>              <span class="dt">highlightOptions =</span> <span class="kw">highlightOptions</span>(<span class="dt">color =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb23-15"><a href="#cb23-15"></a>                                                  <span class="dt">weight =</span> <span class="dv">2</span>,</span>
<span id="cb23-16"><a href="#cb23-16"></a>                                                  <span class="dt">bringToFront =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></span>
<span id="cb23-17"><a href="#cb23-17"></a><span class="st">  </span><span class="kw">frameWidget</span>()</span></code></pre></div>
<div id="htmlwidget-13" style="width:100%;height:480px;" class="widgetframe html-widget"></div>
<script type="application/json" data-for="htmlwidget-13">{"x":{"url":"/notes/leaflet_files/figure-html//widgets/widget_choropleth-color.html","options":{"xdomain":"*","allowfullscreen":false,"lazyload":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="custom-information" class="section level2">
<h2><span class="header-section-number">0.8</span> Custom information</h2>
<p>Let’s now modify the label to explicitly identify the number of reported homicides in the community area. We generate the HTML by hand and pass it to <code>map(htmltools::HTML)</code> so that Leaflet knows to treat each label as HTML instead of plain text. We also adjust the appearance of each label using the <code>labelOptions</code> argument and corresponding function.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>areas_homicides <span class="op">%&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">popup =</span> <span class="kw">str_c</span>(<span class="st">&quot;&lt;strong&gt;&quot;</span>, community, <span class="st">&quot;&lt;/strong&gt;&quot;</span>,</span>
<span id="cb24-3"><a href="#cb24-3"></a>                       <span class="st">&quot;&lt;br/&gt;&quot;</span>,</span>
<span id="cb24-4"><a href="#cb24-4"></a>                       <span class="st">&quot;Reported homicides in 2017: &quot;</span>, n) <span class="op">%&gt;%</span></span>
<span id="cb24-5"><a href="#cb24-5"></a><span class="st">           </span><span class="kw">map</span>(htmltools<span class="op">::</span>HTML)) <span class="op">%&gt;%</span></span>
<span id="cb24-6"><a href="#cb24-6"></a><span class="st">  </span><span class="kw">leaflet</span>() <span class="op">%&gt;%</span></span>
<span id="cb24-7"><a href="#cb24-7"></a><span class="st">  </span><span class="kw">addTiles</span>() <span class="op">%&gt;%</span></span>
<span id="cb24-8"><a href="#cb24-8"></a><span class="st">  </span><span class="kw">addPolygons</span>(<span class="dt">label =</span> <span class="op">~</span>popup,</span>
<span id="cb24-9"><a href="#cb24-9"></a>              <span class="dt">fillColor =</span> <span class="op">~</span><span class="kw">pal</span>(n),</span>
<span id="cb24-10"><a href="#cb24-10"></a>              <span class="dt">color =</span> <span class="st">&quot;#444444&quot;</span>,</span>
<span id="cb24-11"><a href="#cb24-11"></a>              <span class="dt">weight =</span> <span class="dv">1</span>,</span>
<span id="cb24-12"><a href="#cb24-12"></a>              <span class="dt">smoothFactor =</span> <span class="fl">0.5</span>,</span>
<span id="cb24-13"><a href="#cb24-13"></a>              <span class="dt">opacity =</span> <span class="fl">1.0</span>,</span>
<span id="cb24-14"><a href="#cb24-14"></a>              <span class="dt">fillOpacity =</span> <span class="fl">0.5</span>,</span>
<span id="cb24-15"><a href="#cb24-15"></a>              <span class="dt">highlightOptions =</span> <span class="kw">highlightOptions</span>(<span class="dt">color =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb24-16"><a href="#cb24-16"></a>                                                  <span class="dt">weight =</span> <span class="dv">2</span>,</span>
<span id="cb24-17"><a href="#cb24-17"></a>                                                  <span class="dt">bringToFront =</span> <span class="ot">TRUE</span>),</span>
<span id="cb24-18"><a href="#cb24-18"></a>              <span class="dt">labelOptions =</span> <span class="kw">labelOptions</span>(</span>
<span id="cb24-19"><a href="#cb24-19"></a>                <span class="dt">style =</span> <span class="kw">list</span>(<span class="st">&quot;font-weight&quot;</span> =<span class="st"> &quot;normal&quot;</span>, <span class="dt">padding =</span> <span class="st">&quot;3px 8px&quot;</span>),</span>
<span id="cb24-20"><a href="#cb24-20"></a>                <span class="dt">textsize =</span> <span class="st">&quot;15px&quot;</span>,</span>
<span id="cb24-21"><a href="#cb24-21"></a>                <span class="dt">direction =</span> <span class="st">&quot;auto&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb24-22"><a href="#cb24-22"></a><span class="st">  </span><span class="kw">frameWidget</span>()</span></code></pre></div>
<div id="htmlwidget-14" style="width:100%;height:480px;" class="widgetframe html-widget"></div>
<script type="application/json" data-for="htmlwidget-14">{"x":{"url":"/notes/leaflet_files/figure-html//widgets/widget_choropleth-label-detail.html","options":{"xdomain":"*","allowfullscreen":false,"lazyload":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="add-legend" class="section level2">
<h2><span class="header-section-number">0.9</span> Add legend</h2>
<p>Finally, we add a legend using <code>addLegend()</code>.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>areas_homicides <span class="op">%&gt;%</span></span>
<span id="cb25-2"><a href="#cb25-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">popup =</span> <span class="kw">str_c</span>(<span class="st">&quot;&lt;strong&gt;&quot;</span>, community, <span class="st">&quot;&lt;/strong&gt;&quot;</span>,</span>
<span id="cb25-3"><a href="#cb25-3"></a>                       <span class="st">&quot;&lt;br/&gt;&quot;</span>,</span>
<span id="cb25-4"><a href="#cb25-4"></a>                       <span class="st">&quot;Reported homicides in 2017: &quot;</span>, n) <span class="op">%&gt;%</span></span>
<span id="cb25-5"><a href="#cb25-5"></a><span class="st">           </span><span class="kw">map</span>(htmltools<span class="op">::</span>HTML)) <span class="op">%&gt;%</span></span>
<span id="cb25-6"><a href="#cb25-6"></a><span class="st">  </span><span class="kw">leaflet</span>() <span class="op">%&gt;%</span></span>
<span id="cb25-7"><a href="#cb25-7"></a><span class="st">  </span><span class="kw">addTiles</span>() <span class="op">%&gt;%</span></span>
<span id="cb25-8"><a href="#cb25-8"></a><span class="st">  </span><span class="kw">addPolygons</span>(<span class="dt">label =</span> <span class="op">~</span>popup,</span>
<span id="cb25-9"><a href="#cb25-9"></a>              <span class="dt">fillColor =</span> <span class="op">~</span><span class="kw">pal</span>(n),</span>
<span id="cb25-10"><a href="#cb25-10"></a>              <span class="dt">color =</span> <span class="st">&quot;#444444&quot;</span>,</span>
<span id="cb25-11"><a href="#cb25-11"></a>              <span class="dt">weight =</span> <span class="dv">1</span>,</span>
<span id="cb25-12"><a href="#cb25-12"></a>              <span class="dt">smoothFactor =</span> <span class="fl">0.5</span>,</span>
<span id="cb25-13"><a href="#cb25-13"></a>              <span class="dt">opacity =</span> <span class="fl">1.0</span>,</span>
<span id="cb25-14"><a href="#cb25-14"></a>              <span class="dt">fillOpacity =</span> <span class="fl">0.5</span>,</span>
<span id="cb25-15"><a href="#cb25-15"></a>              <span class="dt">highlightOptions =</span> <span class="kw">highlightOptions</span>(<span class="dt">color =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb25-16"><a href="#cb25-16"></a>                                                  <span class="dt">weight =</span> <span class="dv">2</span>,</span>
<span id="cb25-17"><a href="#cb25-17"></a>                                                  <span class="dt">bringToFront =</span> <span class="ot">TRUE</span>),</span>
<span id="cb25-18"><a href="#cb25-18"></a>              <span class="dt">labelOptions =</span> <span class="kw">labelOptions</span>(</span>
<span id="cb25-19"><a href="#cb25-19"></a>                <span class="dt">style =</span> <span class="kw">list</span>(<span class="st">&quot;font-weight&quot;</span> =<span class="st"> &quot;normal&quot;</span>, <span class="dt">padding =</span> <span class="st">&quot;3px 8px&quot;</span>),</span>
<span id="cb25-20"><a href="#cb25-20"></a>                <span class="dt">textsize =</span> <span class="st">&quot;15px&quot;</span>,</span>
<span id="cb25-21"><a href="#cb25-21"></a>                <span class="dt">direction =</span> <span class="st">&quot;auto&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb25-22"><a href="#cb25-22"></a><span class="st">  </span><span class="kw">addLegend</span>(<span class="dt">pal =</span> pal,</span>
<span id="cb25-23"><a href="#cb25-23"></a>            <span class="dt">values =</span> <span class="op">~</span>n,</span>
<span id="cb25-24"><a href="#cb25-24"></a>            <span class="dt">opacity =</span> <span class="fl">0.7</span>,</span>
<span id="cb25-25"><a href="#cb25-25"></a>            <span class="dt">title =</span> <span class="ot">NULL</span>,</span>
<span id="cb25-26"><a href="#cb25-26"></a>            <span class="dt">position =</span> <span class="st">&quot;bottomright&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb25-27"><a href="#cb25-27"></a><span class="st">  </span><span class="kw">frameWidget</span>()</span></code></pre></div>
<div id="htmlwidget-15" style="width:100%;height:480px;" class="widgetframe html-widget"></div>
<script type="application/json" data-for="htmlwidget-15">{"x":{"url":"/notes/leaflet_files/figure-html//widgets/widget_choropleth-label-legend.html","options":{"xdomain":"*","allowfullscreen":false,"lazyload":false}},"evals":[],"jsHooks":[]}</script>
<p>The main requirement here is <code>pal = pal</code>, which tells <code>addLegend()</code> the custom palette function used to create the color palette.</p>
</div>
<div id="session-info" class="section level2">
<h2><span class="header-section-number">0.10</span> Session Info</h2>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>devtools<span class="op">::</span><span class="kw">session_info</span>()</span></code></pre></div>
<pre><code>## ─ Session info ───────────────────────────────────────────────────────────────
##  setting  value                       
##  version  R version 3.6.3 (2020-02-29)
##  os       macOS Catalina 10.15.4      
##  system   x86_64, darwin15.6.0        
##  ui       X11                         
##  language (EN)                        
##  collate  en_US.UTF-8                 
##  ctype    en_US.UTF-8                 
##  tz       America/Chicago             
##  date     2020-04-10                  
## 
## ─ Packages ───────────────────────────────────────────────────────────────────
##  package     * version     date       lib source                      
##  assertthat    0.2.1       2019-03-21 [1] CRAN (R 3.6.0)              
##  backports     1.1.5       2019-10-02 [1] CRAN (R 3.6.0)              
##  blogdown      0.18        2020-03-04 [1] CRAN (R 3.6.0)              
##  bookdown      0.18        2020-03-05 [1] CRAN (R 3.6.0)              
##  broom         0.5.5       2020-02-29 [1] CRAN (R 3.6.0)              
##  callr         3.4.2       2020-02-12 [1] CRAN (R 3.6.1)              
##  cellranger    1.1.0       2016-07-27 [1] CRAN (R 3.6.0)              
##  class         7.3-16      2020-03-25 [1] CRAN (R 3.6.3)              
##  classInt      0.4-2       2019-10-17 [1] CRAN (R 3.6.0)              
##  cli           2.0.2       2020-02-28 [1] CRAN (R 3.6.0)              
##  colorspace    1.4-1       2019-03-18 [1] CRAN (R 3.6.0)              
##  crayon        1.3.4       2017-09-16 [1] CRAN (R 3.6.0)              
##  crosstalk     1.1.0.1     2020-03-13 [1] CRAN (R 3.6.0)              
##  DBI           1.1.0       2019-12-15 [1] CRAN (R 3.6.0)              
##  dbplyr        1.4.2       2019-06-17 [1] CRAN (R 3.6.0)              
##  desc          1.2.0       2018-05-01 [1] CRAN (R 3.6.0)              
##  devtools      2.2.2       2020-02-17 [1] CRAN (R 3.6.0)              
##  digest        0.6.25      2020-02-23 [1] CRAN (R 3.6.0)              
##  dplyr       * 0.8.5       2020-03-07 [1] CRAN (R 3.6.0)              
##  e1071         1.7-3       2019-11-26 [1] CRAN (R 3.6.0)              
##  ellipsis      0.3.0       2019-09-20 [1] CRAN (R 3.6.0)              
##  evaluate      0.14        2019-05-28 [1] CRAN (R 3.6.0)              
##  fansi         0.4.1       2020-01-08 [1] CRAN (R 3.6.0)              
##  forcats     * 0.5.0       2020-03-01 [1] CRAN (R 3.6.0)              
##  fs            1.3.2       2020-03-05 [1] CRAN (R 3.6.0)              
##  generics      0.0.2       2018-11-29 [1] CRAN (R 3.6.0)              
##  ggplot2     * 3.3.0       2020-03-05 [1] CRAN (R 3.6.0)              
##  glue          1.3.2       2020-03-12 [1] CRAN (R 3.6.0)              
##  gtable        0.3.0       2019-03-25 [1] CRAN (R 3.6.0)              
##  haven         2.2.0       2019-11-08 [1] CRAN (R 3.6.0)              
##  here        * 0.1         2017-05-28 [1] CRAN (R 3.6.0)              
##  hms           0.5.3       2020-01-08 [1] CRAN (R 3.6.0)              
##  htmltools     0.4.0       2019-10-04 [1] CRAN (R 3.6.0)              
##  htmlwidgets * 1.5.1       2019-10-08 [1] CRAN (R 3.6.0)              
##  httr          1.4.1       2019-08-05 [1] CRAN (R 3.6.0)              
##  jsonlite      1.6.1       2020-02-02 [1] CRAN (R 3.6.0)              
##  KernSmooth    2.23-16     2019-10-15 [1] CRAN (R 3.6.3)              
##  knitr         1.28        2020-02-06 [1] CRAN (R 3.6.0)              
##  lattice       0.20-40     2020-02-19 [1] CRAN (R 3.6.0)              
##  leaflet     * 2.0.3       2019-11-16 [1] CRAN (R 3.6.0)              
##  lifecycle     0.2.0       2020-03-06 [1] CRAN (R 3.6.0)              
##  lubridate     1.7.4       2018-04-11 [1] CRAN (R 3.6.0)              
##  magrittr      1.5         2014-11-22 [1] CRAN (R 3.6.0)              
##  memoise       1.1.0       2017-04-21 [1] CRAN (R 3.6.0)              
##  modelr        0.1.6       2020-02-22 [1] CRAN (R 3.6.0)              
##  munsell       0.5.0       2018-06-12 [1] CRAN (R 3.6.0)              
##  nlme          3.1-145     2020-03-04 [1] CRAN (R 3.6.0)              
##  pillar        1.4.3       2019-12-20 [1] CRAN (R 3.6.0)              
##  pkgbuild      1.0.6       2019-10-09 [1] CRAN (R 3.6.0)              
##  pkgconfig     2.0.3       2019-09-22 [1] CRAN (R 3.6.0)              
##  pkgload       1.0.2       2018-10-29 [1] CRAN (R 3.6.0)              
##  prettyunits   1.1.1       2020-01-24 [1] CRAN (R 3.6.0)              
##  processx      3.4.2       2020-02-09 [1] CRAN (R 3.6.0)              
##  ps            1.3.2       2020-02-13 [1] CRAN (R 3.6.0)              
##  purrr       * 0.3.3       2019-10-18 [1] CRAN (R 3.6.0)              
##  R6            2.4.1       2019-11-12 [1] CRAN (R 3.6.0)              
##  Rcpp          1.0.4       2020-03-17 [1] CRAN (R 3.6.0)              
##  readr       * 1.3.1       2018-12-21 [1] CRAN (R 3.6.0)              
##  readxl        1.3.1       2019-03-13 [1] CRAN (R 3.6.0)              
##  remotes       2.1.1       2020-02-15 [1] CRAN (R 3.6.0)              
##  reprex        0.3.0       2019-05-16 [1] CRAN (R 3.6.0)              
##  rlang         0.4.5.9000  2020-03-19 [1] Github (r-lib/rlang@a90b04b)
##  rmarkdown     2.1         2020-01-20 [1] CRAN (R 3.6.0)              
##  rprojroot     1.3-2       2018-01-03 [1] CRAN (R 3.6.0)              
##  rstudioapi    0.11        2020-02-07 [1] CRAN (R 3.6.0)              
##  rvest         0.3.5       2019-11-08 [1] CRAN (R 3.6.0)              
##  scales        1.1.0       2019-11-18 [1] CRAN (R 3.6.0)              
##  sessioninfo   1.1.1       2018-11-05 [1] CRAN (R 3.6.0)              
##  sf          * 0.8-1       2020-01-28 [1] CRAN (R 3.6.0)              
##  stringi       1.4.6       2020-02-17 [1] CRAN (R 3.6.0)              
##  stringr     * 1.4.0       2019-02-10 [1] CRAN (R 3.6.0)              
##  testthat      2.3.2       2020-03-02 [1] CRAN (R 3.6.0)              
##  tibble      * 2.1.3       2019-06-06 [1] CRAN (R 3.6.0)              
##  tidyr       * 1.0.2       2020-01-24 [1] CRAN (R 3.6.0)              
##  tidyselect    1.0.0       2020-01-27 [1] CRAN (R 3.6.0)              
##  tidyverse   * 1.3.0       2019-11-21 [1] CRAN (R 3.6.0)              
##  units         0.6-6       2020-03-16 [1] CRAN (R 3.6.0)              
##  usethis       1.5.1       2019-07-04 [1] CRAN (R 3.6.0)              
##  vctrs         0.2.99.9010 2020-03-19 [1] Github (r-lib/vctrs@94bea91)
##  widgetframe * 0.3.1       2017-12-20 [1] CRAN (R 3.6.0)              
##  withr         2.1.2       2018-03-15 [1] CRAN (R 3.6.0)              
##  xfun          0.12        2020-01-13 [1] CRAN (R 3.6.0)              
##  xml2          1.2.5       2020-03-11 [1] CRAN (R 3.6.0)              
##  yaml          2.2.1       2020-02-01 [1] CRAN (R 3.6.0)              
## 
## [1] /Library/Frameworks/R.framework/Versions/3.6/Resources/library</code></pre>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p><a href="https://data.cityofchicago.org/Public-Safety/Crimes-2001-to-present/ijzp-q8t2">Full documentation of the data from the larger 2001-present crime dataset.</a>.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
