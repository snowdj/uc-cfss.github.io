<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Getting data from the web: API access</title>
    <meta charset="utf-8" />
    <meta name="author" content="MACS 30500   University of Chicago" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis.css" rel="stylesheet" />
    <link href="libs/remark-css/lucy-fonts.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Getting data from the web: API access
### <a href="https://cfss.uchicago.edu">MACS 30500</a> <br /> University of Chicago

---




# Methods for obtaining data online

* Click and download
* Install and play
* API query
* Scraping

---

# Click and download

* `read.csv` or `readr::read_csv`
* `downloader` package or `curl`

---

# Application programming interface (API)

- Representational State Transfer (REST)
- Uniform Resource Location (URL)
- HTTP methods
    - GET
    - POST

---

# Application programming interface (API)

![](/img/wikipedia.png)&lt;!-- --&gt;

---

# RESTful queries

1. Submit request to server via URL
1. Return result in a structured format
1. Parse results into a local format

---

# Install and play packages

* Packages with R functions written for existing APIs
* Useful because
    * Reproducible
    * Up-to-date (ideally)
    * Ease of access

---

# `manifestoR`

* Collects and organizes political party manifestos from around the world
* Over 1000 parties from 1945 until today in over 50 countries on five continents
* [`manifestoR`](https://github.com/ManifestoProject/manifestoR)

---

# API authentication

* Key/token
* Obtain key
* Store in `.Rprofile`


```r
# in .Rprofile
options("this_is_my_key" = XXXX)

# later, in the R script:
key &lt;- getOption("this_is_my_key")
```

--

* `usethis::edit_r_profile()`
* Read the documentation - different packages have different storage methods

---

# Load library and set API key


```r
library(manifestoR)

# retrieve API key stored in .Rprofile
mp_setapikey(key = getOption("manifesto_key"))
```

---

# Retrieve the database


```r
(mpds &lt;- mp_maindataset())
```

```
## Connecting to Manifesto Project DB API... 
## Connecting to Manifesto Project DB API... corpus version: 2020-2
```

```
## # A tibble: 4,656 x 174
##    country countryname oecdmember eumember edate        date party partyname    
##      &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt;    &lt;dbl&gt; &lt;date&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;        
##  1      11 Sweden               0        0 1944-09-17 194409 11220 Communist Pa…
##  2      11 Sweden               0        0 1944-09-17 194409 11320 Social Democ…
##  3      11 Sweden               0        0 1944-09-17 194409 11420 People’s Par…
##  4      11 Sweden               0        0 1944-09-17 194409 11620 Right Party  
##  5      11 Sweden               0        0 1944-09-17 194409 11810 Agrarian Par…
##  6      11 Sweden               0        0 1948-09-19 194809 11220 Communist Pa…
##  7      11 Sweden               0        0 1948-09-19 194809 11320 Social Democ…
##  8      11 Sweden               0        0 1948-09-19 194809 11420 People’s Par…
##  9      11 Sweden               0        0 1948-09-19 194809 11620 Right Party  
## 10      11 Sweden               0        0 1948-09-19 194809 11810 Agrarian Par…
## # … with 4,646 more rows, and 166 more variables: partyabbrev &lt;chr&gt;,
## #   parfam &lt;dbl&gt;, coderid &lt;dbl&gt;, manual &lt;dbl&gt;, coderyear &lt;dbl&gt;,
## #   testresult &lt;dbl&gt;, testeditsim &lt;dbl&gt;, pervote &lt;dbl&gt;, voteest &lt;dbl&gt;,
## #   presvote &lt;dbl&gt;, absseat &lt;dbl&gt;, totseats &lt;dbl&gt;, progtype &lt;dbl&gt;,
## #   datasetorigin &lt;dbl&gt;, corpusversion &lt;chr&gt;, total &lt;dbl&gt;, peruncod &lt;dbl&gt;,
## #   per101 &lt;dbl&gt;, per102 &lt;dbl&gt;, per103 &lt;dbl&gt;, per104 &lt;dbl&gt;, per105 &lt;dbl&gt;,
## #   per106 &lt;dbl&gt;, per107 &lt;dbl&gt;, per108 &lt;dbl&gt;, per109 &lt;dbl&gt;, per110 &lt;dbl&gt;,
## #   per201 &lt;dbl&gt;, per202 &lt;dbl&gt;, per203 &lt;dbl&gt;, per204 &lt;dbl&gt;, per301 &lt;dbl&gt;,
## #   per302 &lt;dbl&gt;, per303 &lt;dbl&gt;, per304 &lt;dbl&gt;, per305 &lt;dbl&gt;, per401 &lt;dbl&gt;,
## #   per402 &lt;dbl&gt;, per403 &lt;dbl&gt;, per404 &lt;dbl&gt;, per405 &lt;dbl&gt;, per406 &lt;dbl&gt;,
## #   per407 &lt;dbl&gt;, per408 &lt;dbl&gt;, per409 &lt;dbl&gt;, per410 &lt;dbl&gt;, per411 &lt;dbl&gt;,
## #   per412 &lt;dbl&gt;, per413 &lt;dbl&gt;, per414 &lt;dbl&gt;, per415 &lt;dbl&gt;, per416 &lt;dbl&gt;,
## #   per501 &lt;dbl&gt;, per502 &lt;dbl&gt;, per503 &lt;dbl&gt;, per504 &lt;dbl&gt;, per505 &lt;dbl&gt;,
## #   per506 &lt;dbl&gt;, per507 &lt;dbl&gt;, per601 &lt;dbl&gt;, per602 &lt;dbl&gt;, per603 &lt;dbl&gt;,
## #   per604 &lt;dbl&gt;, per605 &lt;dbl&gt;, per606 &lt;dbl&gt;, per607 &lt;dbl&gt;, per608 &lt;dbl&gt;,
## #   per701 &lt;dbl&gt;, per702 &lt;dbl&gt;, per703 &lt;dbl&gt;, per704 &lt;dbl&gt;, per705 &lt;dbl&gt;,
## #   per706 &lt;dbl&gt;, per1011 &lt;dbl&gt;, per1012 &lt;dbl&gt;, per1013 &lt;dbl&gt;, per1014 &lt;dbl&gt;,
## #   per1015 &lt;dbl&gt;, per1016 &lt;dbl&gt;, per1021 &lt;dbl&gt;, per1022 &lt;dbl&gt;, per1023 &lt;dbl&gt;,
## #   per1024 &lt;dbl&gt;, per1025 &lt;dbl&gt;, per1026 &lt;dbl&gt;, per1031 &lt;dbl&gt;, per1032 &lt;dbl&gt;,
## #   per1033 &lt;dbl&gt;, per2021 &lt;dbl&gt;, per2022 &lt;dbl&gt;, per2023 &lt;dbl&gt;, per2031 &lt;dbl&gt;,
## #   per2032 &lt;dbl&gt;, per2033 &lt;dbl&gt;, per2041 &lt;dbl&gt;, per3011 &lt;dbl&gt;, per3051 &lt;dbl&gt;,
## #   per3052 &lt;dbl&gt;, per3053 &lt;dbl&gt;, per3054 &lt;dbl&gt;, …
```

---

&lt;img src="index_files/figure-html/manifesto-dist-1.png" width="864" /&gt;

---

# Download manifestos



&lt;img src="index_files/figure-html/manifestor-corpus-wordcloud-1.png" width="864" /&gt;

---

# Census data with `tidycensus`

* API to access data from US Census Bureau
    * Decennial census
    * American Community Survey
* Returns tidy data frames with (optional) `sf` geometry
* Search for variables with `load_variables()`

---

# Store API key


```r
library(tidycensus)
```

```r
census_api_key("YOUR API KEY GOES HERE")
```

---

# Obtain data


```r
usa_inc &lt;- get_acs(
  geography = "state",
  variables = c(medincome = "B19013_001"),
  year = 2019
)
usa_inc
```

```
## # A tibble: 52 x 5
##    GEOID NAME                 variable  estimate   moe
##    &lt;chr&gt; &lt;chr&gt;                &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt;
##  1 01    Alabama              medincome    50536   304
##  2 02    Alaska               medincome    77640  1015
##  3 04    Arizona              medincome    58945   266
##  4 05    Arkansas             medincome    47597   328
##  5 06    California           medincome    75235   232
##  6 08    Colorado             medincome    72331   370
##  7 09    Connecticut          medincome    78444   553
##  8 10    Delaware             medincome    68287   696
##  9 11    District of Columbia medincome    86420  1008
## 10 12    Florida              medincome    55660   220
## # … with 42 more rows
```

---

# Visualize data

&lt;img src="index_files/figure-html/income-usa-plot-1.png" width="864" /&gt;


---

# Twitter API

* REST API
* Streaming API


--

* [`rtweet`](http://rtweet.info/)

---

# Using `rtweet`


```r
library(rtweet)
```

* Requires a Twitter account
* Prompt to authorize application on first usage

---


# Searching tweets


```r
rt &lt;- search_tweets(
  q = "#rstats",
  n = 3000,
  include_rts = FALSE
)
rt
```

```
## # A tibble: 2,993 x 90
##    user_id   status_id   created_at          screen_name  text           source 
##    &lt;chr&gt;     &lt;chr&gt;       &lt;dttm&gt;              &lt;chr&gt;        &lt;chr&gt;          &lt;chr&gt;  
##  1 48182992… 1366423847… 2021-03-01 16:23:26 eo_wuerzburg "@Rsc4Earth T… Twitte…
##  2 12921914… 1366423646… 2021-03-01 16:22:38 Programming… "Want to be a… Twitte…
##  3 12921914… 1364824398… 2021-02-25 06:27:48 Programming… "Want to be a… Twitte…
##  4 12921914… 1364824327… 2021-02-25 06:27:31 Programming… "Start Learni… Twitte…
##  5 12921914… 1364824167… 2021-02-25 06:26:53 Programming… "Learn Social… Twitte…
##  6 12921914… 1364548258… 2021-02-24 12:10:31 Programming… "Create Beaut… Twitte…
##  7 12921914… 1365537509… 2021-02-27 05:41:27 Programming… "Want to be a… Twitte…
##  8 12921914… 1365998815… 2021-02-28 12:14:31 Programming… "Start Learni… Twitte…
##  9 12921914… 1366059377… 2021-02-28 16:15:10 Programming… "Learn Social… Twitte…
## 10 12921914… 1366285100… 2021-03-01 07:12:06 Programming… "Create Your … Twitte…
## # … with 2,983 more rows, and 84 more variables: display_text_width &lt;dbl&gt;,
## #   reply_to_status_id &lt;chr&gt;, reply_to_user_id &lt;chr&gt;,
## #   reply_to_screen_name &lt;chr&gt;, is_quote &lt;lgl&gt;, is_retweet &lt;lgl&gt;,
## #   favorite_count &lt;int&gt;, retweet_count &lt;int&gt;, quote_count &lt;int&gt;,
## #   reply_count &lt;int&gt;, hashtags &lt;list&gt;, symbols &lt;list&gt;, urls_url &lt;list&gt;,
## #   urls_t.co &lt;list&gt;, urls_expanded_url &lt;list&gt;, media_url &lt;list&gt;,
## #   media_t.co &lt;list&gt;, media_expanded_url &lt;list&gt;, media_type &lt;list&gt;,
## #   ext_media_url &lt;list&gt;, ext_media_t.co &lt;list&gt;, ext_media_expanded_url &lt;list&gt;,
## #   ext_media_type &lt;chr&gt;, mentions_user_id &lt;list&gt;, mentions_screen_name &lt;list&gt;,
## #   lang &lt;chr&gt;, quoted_status_id &lt;chr&gt;, quoted_text &lt;chr&gt;,
## #   quoted_created_at &lt;dttm&gt;, quoted_source &lt;chr&gt;, quoted_favorite_count &lt;int&gt;,
## #   quoted_retweet_count &lt;int&gt;, quoted_user_id &lt;chr&gt;, quoted_screen_name &lt;chr&gt;,
## #   quoted_name &lt;chr&gt;, quoted_followers_count &lt;int&gt;,
## #   quoted_friends_count &lt;int&gt;, quoted_statuses_count &lt;int&gt;,
## #   quoted_location &lt;chr&gt;, quoted_description &lt;chr&gt;, quoted_verified &lt;lgl&gt;,
## #   retweet_status_id &lt;chr&gt;, retweet_text &lt;chr&gt;, retweet_created_at &lt;dttm&gt;,
## #   retweet_source &lt;chr&gt;, retweet_favorite_count &lt;int&gt;,
## #   retweet_retweet_count &lt;int&gt;, retweet_user_id &lt;chr&gt;,
## #   retweet_screen_name &lt;chr&gt;, retweet_name &lt;chr&gt;,
## #   retweet_followers_count &lt;int&gt;, retweet_friends_count &lt;int&gt;,
## #   retweet_statuses_count &lt;int&gt;, retweet_location &lt;chr&gt;,
## #   retweet_description &lt;chr&gt;, retweet_verified &lt;lgl&gt;, place_url &lt;chr&gt;,
## #   place_name &lt;chr&gt;, place_full_name &lt;chr&gt;, place_type &lt;chr&gt;, country &lt;chr&gt;,
## #   country_code &lt;chr&gt;, geo_coords &lt;list&gt;, coords_coords &lt;list&gt;,
## #   bbox_coords &lt;list&gt;, status_url &lt;chr&gt;, name &lt;chr&gt;, location &lt;chr&gt;,
## #   description &lt;chr&gt;, url &lt;chr&gt;, protected &lt;lgl&gt;, followers_count &lt;int&gt;,
## #   friends_count &lt;int&gt;, listed_count &lt;int&gt;, statuses_count &lt;int&gt;,
## #   favourites_count &lt;int&gt;, account_created_at &lt;dttm&gt;, verified &lt;lgl&gt;,
## #   profile_url &lt;chr&gt;, profile_expanded_url &lt;chr&gt;, account_lang &lt;lgl&gt;,
## #   profile_banner_url &lt;chr&gt;, profile_background_url &lt;chr&gt;,
## #   profile_image_url &lt;chr&gt;
```

---

# Searching users


```r
countvoncount &lt;- get_timeline(user = "countvoncount", n = 2000)
countvoncount
```

```
## # A tibble: 2,000 x 90
##    user_id  status_id    created_at          screen_name text          source   
##    &lt;chr&gt;    &lt;chr&gt;        &lt;dttm&gt;              &lt;chr&gt;       &lt;chr&gt;         &lt;chr&gt;    
##  1 5551297… 13661857178… 2021-03-01 00:37:12 CountVonCo… Two thousand… CountVou…
##  2 5551297… 13661253185… 2021-02-28 20:37:11 CountVonCo… Two thousand… CountVou…
##  3 5551297… 13658535225… 2021-02-28 02:37:10 CountVonCo… Two thousand… CountVou…
##  4 5551297… 13657629236… 2021-02-27 20:37:10 CountVonCo… Two thousand… CountVou…
##  5 5551297… 13654458284… 2021-02-26 23:37:08 CountVonCo… Two thousand… CountVou…
##  6 5551297… 13650381344… 2021-02-25 20:37:07 CountVonCo… Two thousand… CountVou…
##  7 5551297… 13649324359… 2021-02-25 13:37:06 CountVonCo… Two thousand… CountVou…
##  8 5551297… 13647663379… 2021-02-25 02:37:05 CountVonCo… Two thousand… CountVou…
##  9 5551297… 13645851405… 2021-02-24 14:37:04 CountVonCo… Two thousand… CountVou…
## 10 5551297… 13643284440… 2021-02-23 21:37:03 CountVonCo… Two thousand… CountVou…
## # … with 1,990 more rows, and 84 more variables: display_text_width &lt;dbl&gt;,
## #   reply_to_status_id &lt;lgl&gt;, reply_to_user_id &lt;lgl&gt;,
## #   reply_to_screen_name &lt;lgl&gt;, is_quote &lt;lgl&gt;, is_retweet &lt;lgl&gt;,
## #   favorite_count &lt;int&gt;, retweet_count &lt;int&gt;, quote_count &lt;int&gt;,
## #   reply_count &lt;int&gt;, hashtags &lt;list&gt;, symbols &lt;list&gt;, urls_url &lt;list&gt;,
## #   urls_t.co &lt;list&gt;, urls_expanded_url &lt;list&gt;, media_url &lt;list&gt;,
## #   media_t.co &lt;list&gt;, media_expanded_url &lt;list&gt;, media_type &lt;list&gt;,
## #   ext_media_url &lt;list&gt;, ext_media_t.co &lt;list&gt;, ext_media_expanded_url &lt;list&gt;,
## #   ext_media_type &lt;chr&gt;, mentions_user_id &lt;list&gt;, mentions_screen_name &lt;list&gt;,
## #   lang &lt;chr&gt;, quoted_status_id &lt;chr&gt;, quoted_text &lt;chr&gt;,
## #   quoted_created_at &lt;dttm&gt;, quoted_source &lt;chr&gt;, quoted_favorite_count &lt;int&gt;,
## #   quoted_retweet_count &lt;int&gt;, quoted_user_id &lt;chr&gt;, quoted_screen_name &lt;chr&gt;,
## #   quoted_name &lt;chr&gt;, quoted_followers_count &lt;int&gt;,
## #   quoted_friends_count &lt;int&gt;, quoted_statuses_count &lt;int&gt;,
## #   quoted_location &lt;chr&gt;, quoted_description &lt;chr&gt;, quoted_verified &lt;lgl&gt;,
## #   retweet_status_id &lt;chr&gt;, retweet_text &lt;chr&gt;, retweet_created_at &lt;dttm&gt;,
## #   retweet_source &lt;chr&gt;, retweet_favorite_count &lt;int&gt;,
## #   retweet_retweet_count &lt;int&gt;, retweet_user_id &lt;chr&gt;,
## #   retweet_screen_name &lt;chr&gt;, retweet_name &lt;chr&gt;,
## #   retweet_followers_count &lt;int&gt;, retweet_friends_count &lt;int&gt;,
## #   retweet_statuses_count &lt;int&gt;, retweet_location &lt;chr&gt;,
## #   retweet_description &lt;chr&gt;, retweet_verified &lt;lgl&gt;, place_url &lt;chr&gt;,
## #   place_name &lt;chr&gt;, place_full_name &lt;chr&gt;, place_type &lt;chr&gt;, country &lt;chr&gt;,
## #   country_code &lt;chr&gt;, geo_coords &lt;list&gt;, coords_coords &lt;list&gt;,
## #   bbox_coords &lt;list&gt;, status_url &lt;chr&gt;, name &lt;chr&gt;, location &lt;chr&gt;,
## #   description &lt;chr&gt;, url &lt;lgl&gt;, protected &lt;lgl&gt;, followers_count &lt;int&gt;,
## #   friends_count &lt;int&gt;, listed_count &lt;int&gt;, statuses_count &lt;int&gt;,
## #   favourites_count &lt;int&gt;, account_created_at &lt;dttm&gt;, verified &lt;lgl&gt;,
## #   profile_url &lt;chr&gt;, profile_expanded_url &lt;chr&gt;, account_lang &lt;lgl&gt;,
## #   profile_banner_url &lt;chr&gt;, profile_background_url &lt;chr&gt;,
## #   profile_image_url &lt;chr&gt;
```

---

# Visualizing tweets


```r
ts_plot(rt, by = "3 hours")
```

&lt;img src="index_files/figure-html/rstats-freq-1.png" width="864" /&gt;

---

# Visualizing tweets



```r
ts_plot(rt, by = "1 hours")
```

&lt;img src="index_files/figure-html/rstats-freq-day-1.png" width="864" /&gt;

---

# Visualizing tweets


```r
ts_plot(rt, by = "3 hours") +
  theme(plot.title = element_text(face = "bold")) +
  labs(
    x = NULL, y = NULL,
    title = "Frequency of #rstats Twitter statuses from past 9 days",
    subtitle = "Twitter status (tweet) counts aggregated using three-hour intervals",
    caption = "\nSource: Data collected from Twitter's REST API via rtweet"
  )
```

&lt;img src="index_files/figure-html/rstats-freq-clean-1.png" width="864" /&gt;

---

# Exercise: Practice using `rtweet`

.pull-left[

![](https://upload.wikimedia.org/wikipedia/commons/thumb/2/21/Katy_Perry%E2%80%93Zenith_Paris.jpg/360px-Katy_Perry%E2%80%93Zenith_Paris.jpg)

]

.pull-right[

![](https://upload.wikimedia.org/wikipedia/commons/thumb/d/df/Kim_Kardashian_West_2014.jpg/320px-Kim_Kardashian_West_2014.jpg)

]

---

# Writing an API function

* No package for API
* Write your own function!
* [Open Movie Database](http://www.omdbapi.com/)

---

# Expected elements

1. Authentication Key/Token
1. Base URL
1. Search Parameters
1. Response Format

---

# Determine the shape of an API request

![](/img/ombd.png)

---

# Determine the shape of an API request

```http
http://www.omdbapi.com/?apikey=[apikey]&amp;t=Sharknado&amp;y=2013
```


```
## {
##     "Title": "Sharknado",
##     "Year": "2013",
##     "Rated": "TV-14",
##     "Released": "11 Jul 2013",
##     "Runtime": "86 min",
##     "Genre": "Action, Adventure, Comedy, Horror, Sci-Fi, Thriller",
##     "Director": "Anthony C. Ferrante",
##     "Writer": "Thunder Levin",
##     "Actors": "Ian Ziering, Tara Reid, John Heard, Cassandra Scerbo",
##     "Plot": "When a freak hurricane swamps Los Angeles, nature's deadliest killer rules sea, land, and air as thousands of sharks terrorize the waterlogged populace.",
##     "Language": "English",
##     "Country": "USA",
##     "Awards": "1 win &amp; 2 nominations.",
##     "Poster": "https://m.media-amazon.com/images/M/MV5BODcwZWFiNTEtNDgzMC00ZmE2LWExMzYtNzZhZDgzNDc5NDkyXkEyXkFqcGdeQXVyMTQxNzMzNDI@._V1_SX300.jpg",
##     "Ratings": [
##         {
##             "Source": "Internet Movie Database",
##             "Value": "3.3/10"
##         },
##         {
##             "Source": "Rotten Tomatoes",
##             "Value": "74%"
##         }
##     ],
##     "Metascore": "N/A",
##     "imdbRating": "3.3",
##     "imdbVotes": "46,579",
##     "imdbID": "tt2724064",
##     "Type": "movie",
##     "DVD": "N/A",
##     "BoxOffice": "N/A",
##     "Production": "The Asylum, Southward Films",
##     "Website": "N/A",
##     "Response": "True"
## }
## 
```

---

# `httr::GET()`




```r
sharknado &lt;- GET(url = "http://www.omdbapi.com/?",
    query = list(t = "Sharknado",
                 y = 2013,
                 apikey = omdb_key)
)
```

---

# JavaScript Object Notation (JSON)


```r
content(sharknado, type = "text") %&gt;%
  # print the contents in a clear structure
  prettify()
```

```
## {
##     "Title": "Sharknado",
##     "Year": "2013",
##     "Rated": "TV-14",
##     "Released": "11 Jul 2013",
##     "Runtime": "86 min",
##     "Genre": "Action, Adventure, Comedy, Horror, Sci-Fi, Thriller",
##     "Director": "Anthony C. Ferrante",
##     "Writer": "Thunder Levin",
##     "Actors": "Ian Ziering, Tara Reid, John Heard, Cassandra Scerbo",
##     "Plot": "When a freak hurricane swamps Los Angeles, nature's deadliest killer rules sea, land, and air as thousands of sharks terrorize the waterlogged populace.",
##     "Language": "English",
##     "Country": "USA",
##     "Awards": "1 win &amp; 2 nominations.",
##     "Poster": "https://m.media-amazon.com/images/M/MV5BODcwZWFiNTEtNDgzMC00ZmE2LWExMzYtNzZhZDgzNDc5NDkyXkEyXkFqcGdeQXVyMTQxNzMzNDI@._V1_SX300.jpg",
##     "Ratings": [
##         {
##             "Source": "Internet Movie Database",
##             "Value": "3.3/10"
##         },
##         {
##             "Source": "Rotten Tomatoes",
##             "Value": "74%"
##         }
##     ],
##     "Metascore": "N/A",
##     "imdbRating": "3.3",
##     "imdbVotes": "46,579",
##     "imdbID": "tt2724064",
##     "Type": "movie",
##     "DVD": "N/A",
##     "BoxOffice": "N/A",
##     "Production": "The Asylum, Southward Films",
##     "Website": "N/A",
##     "Response": "True"
## }
## 
```

---

# JSON


```r
sharknado_df &lt;- content(sharknado) %&gt;%
  as_tibble()
sharknado_df
```

```
## # A tibble: 2 x 25
##   Title Year  Rated Released Runtime Genre Director Writer Actors Plot  Language
##   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   
## 1 Shar… 2013  TV-14 11 Jul … 86 min  Acti… Anthony… Thund… Ian Z… When… English 
## 2 Shar… 2013  TV-14 11 Jul … 86 min  Acti… Anthony… Thund… Ian Z… When… English 
## # … with 14 more variables: Country &lt;chr&gt;, Awards &lt;chr&gt;, Poster &lt;chr&gt;,
## #   Ratings &lt;list&gt;, Metascore &lt;chr&gt;, imdbRating &lt;chr&gt;, imdbVotes &lt;chr&gt;,
## #   imdbID &lt;chr&gt;, Type &lt;chr&gt;, DVD &lt;chr&gt;, BoxOffice &lt;chr&gt;, Production &lt;chr&gt;,
## #   Website &lt;chr&gt;, Response &lt;chr&gt;
```

---

# Additional information from `GET()`


```r
sharknado$url
```


```
## [1] "http://www.omdbapi.com/?t=Sharknado&amp;y=2013&amp;apikey=[apikey]"
```

--


```r
status_code(sharknado)
```

```
## [1] 200
```

---

# HTTP status code

Code | Status
-------|--------|
1xx    | Informational
2xx    | Success
3xx    | Redirection
4xx    | Client error (you did something wrong)
5xx    | Server error (server did something wrong)

&gt; [A more intuitive guide](https://www.flickr.com/photos/girliemac/sets/72157628409467125)

---

# Iteration through a set of movies


```r
omdb_api &lt;- function(title, api_key){
  # send GET request
  response &lt;- GET(url = "http://www.omdbapi.com/?",
    query = list(t = title,
                 apikey = api_key)
  )
  
  # parse response to JSON
  response_df &lt;- content(response) %&gt;%
    as_tibble()
  
  # print a message to track progress
  message(glue::glue("Scraping {title}..."))
  
  return(response_df)
}
```

---

# Iteration through a set of movies


```r
sharknados &lt;- c("Sharknado", "Sharknado 2", "Sharknado 3",
                "Sharknado 4", "Sharknado 5")
```


```r
# modify function to delay by one second
omdb_api_slow &lt;- purrr::slowly(f = omdb_api, rate = rate_delay(1))

# iterate over all the films
sharknados_df &lt;- map_dfr(.x = sharknados, .f = omdb_api_slow, api_key = getOption("omdb_key"))
```

```
## Scraping Sharknado...
```

```
## Scraping Sharknado 2...
```

```
## Scraping Sharknado 3...
```

```
## Scraping Sharknado 4...
```

```
## Scraping Sharknado 5...
```

---

# Iteration through a set of movies


```r
sharknados_df
```

```
## # A tibble: 10 x 25
##    Title  Year  Rated Released  Runtime Genre   Director Writer  Actors  Plot   
##    &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  
##  1 Shark… 2013  TV-14 11 Jul 2… 86 min  Action… Anthony… Thunde… Ian Zi… When a…
##  2 Shark… 2013  TV-14 11 Jul 2… 86 min  Action… Anthony… Thunde… Ian Zi… When a…
##  3 Shark… 2014  TV-14 30 Jul 2… 95 min  Action… Anthony… Thunde… Ian Zi… Fin an…
##  4 Shark… 2014  TV-14 30 Jul 2… 95 min  Action… Anthony… Thunde… Ian Zi… Fin an…
##  5 Shark… 2015  TV-14 22 Jul 2… 93 min  Action… Anthony… Thunde… Ian Zi… A mons…
##  6 Shark… 2015  TV-14 22 Jul 2… 93 min  Action… Anthony… Thunde… Ian Zi… A mons…
##  7 Shark… 2016  TV-14 31 Jul 2… 95 min  Action… Anthony… Thunde… Ian Zi… Fin, h…
##  8 Shark… 2016  TV-14 31 Jul 2… 95 min  Action… Anthony… Thunde… Ian Zi… Fin, h…
##  9 Shark… 2017  TV-14 06 Aug 2… 93 min  Action… Anthony… Thunde… Ian Zi… With m…
## 10 Shark… 2017  TV-14 06 Aug 2… 93 min  Action… Anthony… Thunde… Ian Zi… With m…
## # … with 15 more variables: Language &lt;chr&gt;, Country &lt;chr&gt;, Awards &lt;chr&gt;,
## #   Poster &lt;chr&gt;, Ratings &lt;list&gt;, Metascore &lt;chr&gt;, imdbRating &lt;chr&gt;,
## #   imdbVotes &lt;chr&gt;, imdbID &lt;chr&gt;, Type &lt;chr&gt;, DVD &lt;chr&gt;, BoxOffice &lt;chr&gt;,
## #   Production &lt;chr&gt;, Website &lt;chr&gt;, Response &lt;chr&gt;
```

---

# Messy API responses


```r
content(sharknado) %&gt;%
  as_tibble()
```

```
## # A tibble: 2 x 25
##   Title Year  Rated Released Runtime Genre Director Writer Actors Plot  Language
##   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   
## 1 Shar… 2013  TV-14 11 Jul … 86 min  Acti… Anthony… Thund… Ian Z… When… English 
## 2 Shar… 2013  TV-14 11 Jul … 86 min  Acti… Anthony… Thund… Ian Z… When… English 
## # … with 14 more variables: Country &lt;chr&gt;, Awards &lt;chr&gt;, Poster &lt;chr&gt;,
## #   Ratings &lt;list&gt;, Metascore &lt;chr&gt;, imdbRating &lt;chr&gt;, imdbVotes &lt;chr&gt;,
## #   imdbID &lt;chr&gt;, Type &lt;chr&gt;, DVD &lt;chr&gt;, BoxOffice &lt;chr&gt;, Production &lt;chr&gt;,
## #   Website &lt;chr&gt;, Response &lt;chr&gt;
```

---

# Whoops


```
## List of 25
##  $ Title     : chr "Sharknado"
##  $ Year      : chr "2013"
##  $ Rated     : chr "TV-14"
##  $ Released  : chr "11 Jul 2013"
##  $ Runtime   : chr "86 min"
##  $ Genre     : chr "Action, Adventure, Comedy, Horror, Sci-Fi, Thriller"
##  $ Director  : chr "Anthony C. Ferrante"
##  $ Writer    : chr "Thunder Levin"
##  $ Actors    : chr "Ian Ziering, Tara Reid, John Heard, Cassandra Scerbo"
##  $ Plot      : chr "When a freak hurricane swamps Los Angeles, nature's deadliest killer rules sea, land, and air as thousands of s"| __truncated__
##  $ Language  : chr "English"
##  $ Country   : chr "USA"
##  $ Awards    : chr "1 win &amp; 2 nominations."
##  $ Poster    : chr "https://m.media-amazon.com/images/M/MV5BODcwZWFiNTEtNDgzMC00ZmE2LWExMzYtNzZhZDgzNDc5NDkyXkEyXkFqcGdeQXVyMTQxNzM"| __truncated__
##  $ Ratings   :List of 2
##   ..$ :List of 2
##   .. ..$ Source: chr "Internet Movie Database"
##   .. ..$ Value : chr "3.3/10"
##   ..$ :List of 2
##   .. ..$ Source: chr "Rotten Tomatoes"
##   .. ..$ Value : chr "74%"
##  $ Metascore : chr "N/A"
##  $ imdbRating: chr "3.3"
##  $ imdbVotes : chr "46,579"
##  $ imdbID    : chr "tt2724064"
##  $ Type      : chr "movie"
##  $ DVD       : chr "N/A"
##  $ BoxOffice : chr "N/A"
##  $ Production: chr "The Asylum, Southward Films"
##  $ Website   : chr "N/A"
##  $ Response  : chr "True"
```

---

# Rectangling and `tidyr`

* Art and craft of taking a deeply nested list and taming it into a tidy data set of rows and columns


* `unnest_longer()` - each row contains multiple observations
* `unnest_wider()` - each row contains a single observation
* `unnest_auto()` - make an educated guess
* `hoist()` - extract a specific element
  
---

# `unnest_wider()` and `hoist()`


```r
str(gh_users, list.len = 3)
```

```
## List of 6
##  $ :List of 30
##   ..$ login              : chr "gaborcsardi"
##   ..$ id                 : int 660288
##   ..$ avatar_url         : chr "https://avatars.githubusercontent.com/u/660288?v=3"
##   .. [list output truncated]
##  $ :List of 30
##   ..$ login              : chr "jennybc"
##   ..$ id                 : int 599454
##   ..$ avatar_url         : chr "https://avatars.githubusercontent.com/u/599454?v=3"
##   .. [list output truncated]
##  $ :List of 30
##   ..$ login              : chr "jtleek"
##   ..$ id                 : int 1571674
##   ..$ avatar_url         : chr "https://avatars.githubusercontent.com/u/1571674?v=3"
##   .. [list output truncated]
##   [list output truncated]
```

---

# `unnest_wider()` and `hoist()`


```r
(users &lt;- tibble(user = gh_users))
```

```
## # A tibble: 6 x 1
##   user             
##   &lt;list&gt;           
## 1 &lt;named list [30]&gt;
## 2 &lt;named list [30]&gt;
## 3 &lt;named list [30]&gt;
## 4 &lt;named list [30]&gt;
## 5 &lt;named list [30]&gt;
## 6 &lt;named list [30]&gt;
```

--


```r
names(users$user[[1]])
```

```
##  [1] "login"               "id"                  "avatar_url"         
##  [4] "gravatar_id"         "url"                 "html_url"           
##  [7] "followers_url"       "following_url"       "gists_url"          
## [10] "starred_url"         "subscriptions_url"   "organizations_url"  
## [13] "repos_url"           "events_url"          "received_events_url"
## [16] "type"                "site_admin"          "name"               
## [19] "company"             "blog"                "location"           
## [22] "email"               "hireable"            "bio"                
## [25] "public_repos"        "public_gists"        "followers"          
## [28] "following"           "created_at"          "updated_at"
```

---

# `unnest_wider()`


```r
users %&gt;%
  unnest_wider(col = user)
```

```
## # A tibble: 6 x 30
##   login     id avatar_url gravatar_id url   html_url followers_url following_url
##   &lt;chr&gt;  &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;         &lt;chr&gt;        
## 1 gabo… 6.60e5 https://a… ""          http… https:/… https://api.… https://api.…
## 2 jenn… 5.99e5 https://a… ""          http… https:/… https://api.… https://api.…
## 3 jtle… 1.57e6 https://a… ""          http… https:/… https://api.… https://api.…
## 4 juli… 1.25e7 https://a… ""          http… https:/… https://api.… https://api.…
## 5 leep… 3.51e6 https://a… ""          http… https:/… https://api.… https://api.…
## 6 masa… 8.36e6 https://a… ""          http… https:/… https://api.… https://api.…
## # … with 22 more variables: gists_url &lt;chr&gt;, starred_url &lt;chr&gt;,
## #   subscriptions_url &lt;chr&gt;, organizations_url &lt;chr&gt;, repos_url &lt;chr&gt;,
## #   events_url &lt;chr&gt;, received_events_url &lt;chr&gt;, type &lt;chr&gt;, site_admin &lt;lgl&gt;,
## #   name &lt;chr&gt;, company &lt;chr&gt;, blog &lt;chr&gt;, location &lt;chr&gt;, email &lt;chr&gt;,
## #   public_repos &lt;int&gt;, public_gists &lt;int&gt;, followers &lt;int&gt;, following &lt;int&gt;,
## #   created_at &lt;chr&gt;, updated_at &lt;chr&gt;, bio &lt;chr&gt;, hireable &lt;lgl&gt;
```

---

# `hoist()`


```r
users %&gt;%
  hoist(
    .col = user,
    followers = "followers",
    login = "login",
    url = "html_url"
  )
```

```
## # A tibble: 6 x 4
##   followers login       url                            user             
##       &lt;int&gt; &lt;chr&gt;       &lt;chr&gt;                          &lt;list&gt;           
## 1       303 gaborcsardi https://github.com/gaborcsardi &lt;named list [27]&gt;
## 2       780 jennybc     https://github.com/jennybc     &lt;named list [27]&gt;
## 3      3958 jtleek      https://github.com/jtleek      &lt;named list [27]&gt;
## 4       115 juliasilge  https://github.com/juliasilge  &lt;named list [27]&gt;
## 5       213 leeper      https://github.com/leeper      &lt;named list [27]&gt;
## 6        34 masalmon    https://github.com/masalmon    &lt;named list [27]&gt;
```

---

# `gh_repos` and nested list structures


```r
(repos &lt;- tibble(repo = gh_repos))
```

```
## # A tibble: 6 x 1
##   repo       
##   &lt;list&gt;     
## 1 &lt;list [30]&gt;
## 2 &lt;list [30]&gt;
## 3 &lt;list [30]&gt;
## 4 &lt;list [26]&gt;
## 5 &lt;list [30]&gt;
## 6 &lt;list [30]&gt;
```

---

# `unnest_longer()`


```r
repos &lt;- repos %&gt;%
  unnest_longer(col = repo)
repos
```

```
## # A tibble: 176 x 1
##    repo             
##    &lt;list&gt;           
##  1 &lt;named list [68]&gt;
##  2 &lt;named list [68]&gt;
##  3 &lt;named list [68]&gt;
##  4 &lt;named list [68]&gt;
##  5 &lt;named list [68]&gt;
##  6 &lt;named list [68]&gt;
##  7 &lt;named list [68]&gt;
##  8 &lt;named list [68]&gt;
##  9 &lt;named list [68]&gt;
## 10 &lt;named list [68]&gt;
## # … with 166 more rows
```

---

# `unnest_longer()`


```r
repos %&gt;%
  hoist(
    .col = repo,
    login = c("owner", "login"),
    name = "name",
    homepage = "homepage",
    watchers = "watchers_count"
  )
```

```
## # A tibble: 176 x 5
##    login       name        homepage watchers repo             
##    &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;       &lt;int&gt; &lt;list&gt;           
##  1 gaborcsardi after        &lt;NA&gt;           5 &lt;named list [65]&gt;
##  2 gaborcsardi argufy       &lt;NA&gt;          19 &lt;named list [65]&gt;
##  3 gaborcsardi ask          &lt;NA&gt;           5 &lt;named list [65]&gt;
##  4 gaborcsardi baseimports  &lt;NA&gt;           0 &lt;named list [65]&gt;
##  5 gaborcsardi citest       &lt;NA&gt;           0 &lt;named list [65]&gt;
##  6 gaborcsardi clisymbols  ""             18 &lt;named list [65]&gt;
##  7 gaborcsardi cmaker       &lt;NA&gt;           0 &lt;named list [65]&gt;
##  8 gaborcsardi cmark        &lt;NA&gt;           0 &lt;named list [65]&gt;
##  9 gaborcsardi conditions   &lt;NA&gt;           0 &lt;named list [65]&gt;
## 10 gaborcsardi crayon       &lt;NA&gt;          52 &lt;named list [65]&gt;
## # … with 166 more rows
```

---



count: false
 

.left-panel-gh-repos-auto-auto[

```r
*tibble(repo = gh_repos)
```
]
 
.right-panel-gh-repos-auto-auto[

```
## # A tibble: 6 x 1
##   repo       
##   &lt;list&gt;     
## 1 &lt;list [30]&gt;
## 2 &lt;list [30]&gt;
## 3 &lt;list [30]&gt;
## 4 &lt;list [26]&gt;
## 5 &lt;list [30]&gt;
## 6 &lt;list [30]&gt;
```
]

---
count: false
 

.left-panel-gh-repos-auto-auto[

```r
tibble(repo = gh_repos) %&gt;%  
* unnest_auto(col = repo)
```
]
 
.right-panel-gh-repos-auto-auto[

```
## # A tibble: 176 x 1
##    repo             
##    &lt;list&gt;           
##  1 &lt;named list [68]&gt;
##  2 &lt;named list [68]&gt;
##  3 &lt;named list [68]&gt;
##  4 &lt;named list [68]&gt;
##  5 &lt;named list [68]&gt;
##  6 &lt;named list [68]&gt;
##  7 &lt;named list [68]&gt;
##  8 &lt;named list [68]&gt;
##  9 &lt;named list [68]&gt;
## 10 &lt;named list [68]&gt;
## # … with 166 more rows
```
]

---
count: false
 

.left-panel-gh-repos-auto-auto[

```r
tibble(repo = gh_repos) %&gt;%  
  unnest_auto(col = repo) %&gt;%  
* unnest_auto(col = repo)
```
]
 
.right-panel-gh-repos-auto-auto[

```
## # A tibble: 176 x 67
##         id name   full_name  owner private html_url  description   fork  url    
##      &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;      &lt;lis&gt; &lt;lgl&gt;   &lt;chr&gt;     &lt;chr&gt;         &lt;lgl&gt; &lt;chr&gt;  
##  1  6.12e7 after  gaborcsar… &lt;nam… FALSE   https://… Run Code in … FALSE https:…
##  2  4.05e7 argufy gaborcsar… &lt;nam… FALSE   https://… Declarative … FALSE https:…
##  3  3.64e7 ask    gaborcsar… &lt;nam… FALSE   https://… Friendly CLI… FALSE https:…
##  4  3.49e7 basei… gaborcsar… &lt;nam… FALSE   https://… Do we get wa… FALSE https:…
##  5  6.16e7 citest gaborcsar… &lt;nam… FALSE   https://… Test R packa… TRUE  https:…
##  6  3.39e7 clisy… gaborcsar… &lt;nam… FALSE   https://… Unicode symb… FALSE https:…
##  7  3.72e7 cmaker gaborcsar… &lt;nam… FALSE   https://… port of cmak… TRUE  https:…
##  8  6.80e7 cmark  gaborcsar… &lt;nam… FALSE   https://… CommonMark p… TRUE  https:…
##  9  6.32e7 condi… gaborcsar… &lt;nam… FALSE   https://… &lt;NA&gt;          TRUE  https:…
## 10  2.43e7 crayon gaborcsar… &lt;nam… FALSE   https://… R package fo… FALSE https:…
## # … with 166 more rows, and 58 more variables: forks_url &lt;chr&gt;, keys_url &lt;chr&gt;,
## #   collaborators_url &lt;chr&gt;, teams_url &lt;chr&gt;, hooks_url &lt;chr&gt;,
## #   issue_events_url &lt;chr&gt;, events_url &lt;chr&gt;, assignees_url &lt;chr&gt;,
## #   branches_url &lt;chr&gt;, tags_url &lt;chr&gt;, blobs_url &lt;chr&gt;, git_tags_url &lt;chr&gt;,
## #   git_refs_url &lt;chr&gt;, trees_url &lt;chr&gt;, statuses_url &lt;chr&gt;,
## #   languages_url &lt;chr&gt;, stargazers_url &lt;chr&gt;, contributors_url &lt;chr&gt;,
## #   subscribers_url &lt;chr&gt;, subscription_url &lt;chr&gt;, commits_url &lt;chr&gt;,
## #   git_commits_url &lt;chr&gt;, comments_url &lt;chr&gt;, issue_comment_url &lt;chr&gt;,
## #   contents_url &lt;chr&gt;, compare_url &lt;chr&gt;, merges_url &lt;chr&gt;, archive_url &lt;chr&gt;,
## #   downloads_url &lt;chr&gt;, issues_url &lt;chr&gt;, pulls_url &lt;chr&gt;,
## #   milestones_url &lt;chr&gt;, notifications_url &lt;chr&gt;, labels_url &lt;chr&gt;,
## #   releases_url &lt;chr&gt;, deployments_url &lt;chr&gt;, created_at &lt;chr&gt;,
## #   updated_at &lt;chr&gt;, pushed_at &lt;chr&gt;, git_url &lt;chr&gt;, ssh_url &lt;chr&gt;,
## #   clone_url &lt;chr&gt;, svn_url &lt;chr&gt;, size &lt;int&gt;, stargazers_count &lt;int&gt;,
## #   watchers_count &lt;int&gt;, language &lt;chr&gt;, has_issues &lt;lgl&gt;,
## #   has_downloads &lt;lgl&gt;, has_wiki &lt;lgl&gt;, has_pages &lt;lgl&gt;, forks_count &lt;int&gt;,
## #   open_issues_count &lt;int&gt;, forks &lt;int&gt;, open_issues &lt;int&gt;, watchers &lt;int&gt;,
## #   default_branch &lt;chr&gt;, homepage &lt;chr&gt;
```
]

&lt;style&gt;
.left-panel-gh-repos-auto-auto {
  color: #777;
  width: 38.6138613861386%;
  height: 92%;
  float: left;
  font-size: 80%
}
.right-panel-gh-repos-auto-auto {
  width: 59.4059405940594%;
  float: right;
  padding-left: 1%;
  font-size: 80%
}
.middle-panel-gh-repos-auto-auto {
  width: 0%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;



---

# ASOIAF characters


```r
chars &lt;- tibble(char = got_chars)
chars
```

```
## # A tibble: 30 x 1
##    char             
##    &lt;list&gt;           
##  1 &lt;named list [18]&gt;
##  2 &lt;named list [18]&gt;
##  3 &lt;named list [18]&gt;
##  4 &lt;named list [18]&gt;
##  5 &lt;named list [18]&gt;
##  6 &lt;named list [18]&gt;
##  7 &lt;named list [18]&gt;
##  8 &lt;named list [18]&gt;
##  9 &lt;named list [18]&gt;
## 10 &lt;named list [18]&gt;
## # … with 20 more rows
```

---

# ASOIAF characters


```r
chars2 &lt;- chars %&gt;%
  unnest_wider(col = char)
chars2
```

```
## # A tibble: 30 x 18
##    url        id name   gender culture born   died   alive titles aliases father
##    &lt;chr&gt;   &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;  &lt;lgl&gt; &lt;list&gt; &lt;list&gt;  &lt;chr&gt; 
##  1 https:…  1022 Theon… Male   "Ironb… "In 2… ""     TRUE  &lt;chr … &lt;chr [… ""    
##  2 https:…  1052 Tyrio… Male   ""      "In 2… ""     TRUE  &lt;chr … &lt;chr [… ""    
##  3 https:…  1074 Victa… Male   "Ironb… "In 2… ""     TRUE  &lt;chr … &lt;chr [… ""    
##  4 https:…  1109 Will   Male   ""      ""     "In 2… FALSE &lt;chr … &lt;chr [… ""    
##  5 https:…  1166 Areo … Male   "Norvo… "In 2… ""     TRUE  &lt;chr … &lt;chr [… ""    
##  6 https:…  1267 Chett  Male   ""      "At H… "In 2… FALSE &lt;chr … &lt;chr [… ""    
##  7 https:…  1295 Cress… Male   ""      "In 2… "In 2… FALSE &lt;chr … &lt;chr [… ""    
##  8 https:…   130 Arian… Female "Dorni… "In 2… ""     TRUE  &lt;chr … &lt;chr [… ""    
##  9 https:…  1303 Daene… Female "Valyr… "In 2… ""     TRUE  &lt;chr … &lt;chr [… ""    
## 10 https:…  1319 Davos… Male   "Weste… "In 2… ""     TRUE  &lt;chr … &lt;chr [… ""    
## # … with 20 more rows, and 7 more variables: mother &lt;chr&gt;, spouse &lt;chr&gt;,
## #   allegiances &lt;list&gt;, books &lt;list&gt;, povBooks &lt;list&gt;, tvSeries &lt;list&gt;,
## #   playedBy &lt;list&gt;
```

---

# Nested list objects


```r
chars2 %&gt;%
  select(where(is.list))
```

```
## # A tibble: 30 x 7
##    titles    aliases    allegiances books     povBooks  tvSeries  playedBy 
##    &lt;list&gt;    &lt;list&gt;     &lt;list&gt;      &lt;list&gt;    &lt;list&gt;    &lt;list&gt;    &lt;list&gt;   
##  1 &lt;chr [3]&gt; &lt;chr [4]&gt;  &lt;chr [1]&gt;   &lt;chr [3]&gt; &lt;chr [2]&gt; &lt;chr [6]&gt; &lt;chr [1]&gt;
##  2 &lt;chr [2]&gt; &lt;chr [11]&gt; &lt;chr [1]&gt;   &lt;chr [2]&gt; &lt;chr [4]&gt; &lt;chr [6]&gt; &lt;chr [1]&gt;
##  3 &lt;chr [2]&gt; &lt;chr [1]&gt;  &lt;chr [1]&gt;   &lt;chr [3]&gt; &lt;chr [2]&gt; &lt;chr [1]&gt; &lt;chr [1]&gt;
##  4 &lt;chr [1]&gt; &lt;chr [1]&gt;  &lt;NULL&gt;      &lt;chr [1]&gt; &lt;chr [1]&gt; &lt;chr [1]&gt; &lt;chr [1]&gt;
##  5 &lt;chr [1]&gt; &lt;chr [1]&gt;  &lt;chr [1]&gt;   &lt;chr [3]&gt; &lt;chr [2]&gt; &lt;chr [2]&gt; &lt;chr [1]&gt;
##  6 &lt;chr [1]&gt; &lt;chr [1]&gt;  &lt;NULL&gt;      &lt;chr [2]&gt; &lt;chr [1]&gt; &lt;chr [1]&gt; &lt;chr [1]&gt;
##  7 &lt;chr [1]&gt; &lt;chr [1]&gt;  &lt;NULL&gt;      &lt;chr [2]&gt; &lt;chr [1]&gt; &lt;chr [1]&gt; &lt;chr [1]&gt;
##  8 &lt;chr [1]&gt; &lt;chr [1]&gt;  &lt;chr [1]&gt;   &lt;chr [4]&gt; &lt;chr [1]&gt; &lt;chr [1]&gt; &lt;chr [1]&gt;
##  9 &lt;chr [5]&gt; &lt;chr [11]&gt; &lt;chr [1]&gt;   &lt;chr [1]&gt; &lt;chr [4]&gt; &lt;chr [6]&gt; &lt;chr [1]&gt;
## 10 &lt;chr [4]&gt; &lt;chr [5]&gt;  &lt;chr [2]&gt;   &lt;chr [1]&gt; &lt;chr [3]&gt; &lt;chr [5]&gt; &lt;chr [1]&gt;
## # … with 20 more rows
```

---

# Choose your own adventure

.center[

![:scale 40%](https://images-na.ssl-images-amazon.com/images/I/81E88dflPeL.jpg)

]

---

class: inverse, center, middle

# Every appearance per book/season

---



count: false
 

.left-panel-got-appearances-auto[

```r
*select(
* .data = chars2,
* name, books, tvSeries
*) 
```
]
 
.right-panel-got-appearances-auto[

```
## # A tibble: 30 x 3
##    name               books     tvSeries 
##    &lt;chr&gt;              &lt;list&gt;    &lt;list&gt;   
##  1 Theon Greyjoy      &lt;chr [3]&gt; &lt;chr [6]&gt;
##  2 Tyrion Lannister   &lt;chr [2]&gt; &lt;chr [6]&gt;
##  3 Victarion Greyjoy  &lt;chr [3]&gt; &lt;chr [1]&gt;
##  4 Will               &lt;chr [1]&gt; &lt;chr [1]&gt;
##  5 Areo Hotah         &lt;chr [3]&gt; &lt;chr [2]&gt;
##  6 Chett              &lt;chr [2]&gt; &lt;chr [1]&gt;
##  7 Cressen            &lt;chr [2]&gt; &lt;chr [1]&gt;
##  8 Arianne Martell    &lt;chr [4]&gt; &lt;chr [1]&gt;
##  9 Daenerys Targaryen &lt;chr [1]&gt; &lt;chr [6]&gt;
## 10 Davos Seaworth     &lt;chr [1]&gt; &lt;chr [5]&gt;
## # … with 20 more rows
```
]

---
count: false
 

.left-panel-got-appearances-auto[

```r
select(  
  .data = chars2,  
  name, books, tvSeries  
) %&gt;%  
* pivot_longer(
*   cols = c(books, tvSeries),
*   names_to = "media",
*   values_to = "value"
* )
```
]
 
.right-panel-got-appearances-auto[

```
## # A tibble: 60 x 3
##    name              media    value    
##    &lt;chr&gt;             &lt;chr&gt;    &lt;list&gt;   
##  1 Theon Greyjoy     books    &lt;chr [3]&gt;
##  2 Theon Greyjoy     tvSeries &lt;chr [6]&gt;
##  3 Tyrion Lannister  books    &lt;chr [2]&gt;
##  4 Tyrion Lannister  tvSeries &lt;chr [6]&gt;
##  5 Victarion Greyjoy books    &lt;chr [3]&gt;
##  6 Victarion Greyjoy tvSeries &lt;chr [1]&gt;
##  7 Will              books    &lt;chr [1]&gt;
##  8 Will              tvSeries &lt;chr [1]&gt;
##  9 Areo Hotah        books    &lt;chr [3]&gt;
## 10 Areo Hotah        tvSeries &lt;chr [2]&gt;
## # … with 50 more rows
```
]

---
count: false
 

.left-panel-got-appearances-auto[

```r
select(  
  .data = chars2,  
  name, books, tvSeries  
) %&gt;%  
  pivot_longer(  
    cols = c(books, tvSeries),  
    names_to = "media",  
    values_to = "value"  
  ) %&gt;%  
* unnest_longer(col = value)
```
]
 
.right-panel-got-appearances-auto[

```
## # A tibble: 180 x 3
##    name             media    value            
##    &lt;chr&gt;            &lt;chr&gt;    &lt;chr&gt;            
##  1 Theon Greyjoy    books    A Game of Thrones
##  2 Theon Greyjoy    books    A Storm of Swords
##  3 Theon Greyjoy    books    A Feast for Crows
##  4 Theon Greyjoy    tvSeries Season 1         
##  5 Theon Greyjoy    tvSeries Season 2         
##  6 Theon Greyjoy    tvSeries Season 3         
##  7 Theon Greyjoy    tvSeries Season 4         
##  8 Theon Greyjoy    tvSeries Season 5         
##  9 Theon Greyjoy    tvSeries Season 6         
## 10 Tyrion Lannister books    A Feast for Crows
## # … with 170 more rows
```
]

&lt;style&gt;
.left-panel-got-appearances-auto {
  color: #777;
  width: 38.6138613861386%;
  height: 92%;
  float: left;
  font-size: 80%
}
.right-panel-got-appearances-auto {
  width: 59.4059405940594%;
  float: right;
  padding-left: 1%;
  font-size: 80%
}
.middle-panel-got-appearances-auto {
  width: 0%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;



---

class: inverse, center, middle

# Match character's title to their name

---



count: false
 

.left-panel-got-title-name-auto[

```r
*select(
* .data = chars2,
* name,
* title = titles
*) 
```
]
 
.right-panel-got-title-name-auto[

```
## # A tibble: 30 x 2
##    name               title    
##    &lt;chr&gt;              &lt;list&gt;   
##  1 Theon Greyjoy      &lt;chr [3]&gt;
##  2 Tyrion Lannister   &lt;chr [2]&gt;
##  3 Victarion Greyjoy  &lt;chr [2]&gt;
##  4 Will               &lt;chr [1]&gt;
##  5 Areo Hotah         &lt;chr [1]&gt;
##  6 Chett              &lt;chr [1]&gt;
##  7 Cressen            &lt;chr [1]&gt;
##  8 Arianne Martell    &lt;chr [1]&gt;
##  9 Daenerys Targaryen &lt;chr [5]&gt;
## 10 Davos Seaworth     &lt;chr [4]&gt;
## # … with 20 more rows
```
]

---
count: false
 

.left-panel-got-title-name-auto[

```r
select(  
  .data = chars2,  
  name,  
  title = titles  
) %&gt;%  
* unnest_longer(col = title)
```
]
 
.right-panel-got-title-name-auto[

```
## # A tibble: 60 x 2
##    name              title                                                 
##    &lt;chr&gt;             &lt;chr&gt;                                                 
##  1 Theon Greyjoy     "Prince of Winterfell"                                
##  2 Theon Greyjoy     "Captain of Sea Bitch"                                
##  3 Theon Greyjoy     "Lord of the Iron Islands (by law of the green lands)"
##  4 Tyrion Lannister  "Acting Hand of the King (former)"                    
##  5 Tyrion Lannister  "Master of Coin (former)"                             
##  6 Victarion Greyjoy "Lord Captain of the Iron Fleet"                      
##  7 Victarion Greyjoy "Master of the Iron Victory"                          
##  8 Will              ""                                                    
##  9 Areo Hotah        "Captain of the Guard at Sunspear"                    
## 10 Chett             ""                                                    
## # … with 50 more rows
```
]

&lt;style&gt;
.left-panel-got-title-name-auto {
  color: #777;
  width: 38.6138613861386%;
  height: 92%;
  float: left;
  font-size: 80%
}
.right-panel-got-title-name-auto {
  width: 59.4059405940594%;
  float: right;
  padding-left: 1%;
  font-size: 80%
}
.middle-panel-got-title-name-auto {
  width: 0%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;



---

# May the force be with you

&lt;div style="width:100%;height:0;padding-bottom:50%;position:relative;"&gt;&lt;iframe src="https://giphy.com/embed/C0ZArORmrDQCRTIFnQ" width="100%" height="100%" style="position:absolute" frameBorder="0" class="giphy-embed" allowFullScreen&gt;&lt;/iframe&gt;&lt;/div&gt;
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="https://cfss.uchicago.edu/slides/macros.js"></script>
<script src="https://platform.twitter.com/widgets.js"></script>
<script>var slideshow = remark.create({
"highlightLanguage": "r",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
