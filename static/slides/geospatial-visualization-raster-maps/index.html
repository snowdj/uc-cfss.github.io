<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>Geospatial visualization: raster maps</title>
    <meta charset="utf-8" />
    <meta name="author" content="MACS 30500   University of Chicago" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis.css" rel="stylesheet" />
    <link href="libs/remark-css/lucy-fonts.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Geospatial visualization: raster maps
### <a href="https://cfss.uchicago.edu">MACS 30500</a> <br /> University of Chicago

---




# Geospatial visualizations

* Earliest form of information visualizations
* Geospatial data visualizations
* [Google Maps](https://www.google.com/maps)

---

# Dr. John Snow

.center[

[![:scale 70%](https://upload.wikimedia.org/wikipedia/commons/2/27/Snow-cholera-map-1.jpg)](https://commons.wikimedia.org/wiki/File:Snow-cholera-map-1.jpg)

]

---

# Minard's map of Napoleon's march on Russia

[![Charles Minard's 1869 chart showing the number of men in Napoleon’s 1812 Russian campaign army, their movements, as well as the temperature they encountered on the return path. Source: Wikipedia.](https://upload.wikimedia.org/wikipedia/commons/2/29/Minard.png)](https://en.wikipedia.org/wiki/File:Minard.png)

---

# Minard's map of Napoleon's march on Russia

[![English translation of Minard's map](https://upload.wikimedia.org/wikipedia/commons/thumb/e/e2/Minard_Update.png/1280px-Minard_Update.png)](https://commons.wikimedia.org/wiki/File:Minard_Update.png)

---

# Designing modern maps

* Depict spatial features
* Incorporate additional attributes and information
* Major features
    * Scale
    * Projection
    * Symbols

---

# Scale

* Proportion between distances and sizes on a map and their actual distances and sizes on Earth
* Small-scale map
* Large-scale map


---

# Large-scale map

&lt;img src="index_files/figure-html/large-scale-1.png" width="864" /&gt;

---

# Small-scale map

&lt;img src="index_files/figure-html/small-scale-1.png" width="864" /&gt;

---

# Projection

* Process of taking a three-dimensional object and visualizing it on a two-dimensional surface
* No 100% perfect method for this
* Always introduces distortions
* Properties of projection methods
    1. Shape
    1. Area
    1. Angles
    1. Distance
    1. Direction

---

# Conformal projections



&lt;img src="index_files/figure-html/mercator-1.png" width="864" /&gt;

---

# Equal-area projections

&lt;img src="index_files/figure-html/equal-area-1.png" width="864" /&gt;

---

# Mollweide

&lt;img src="index_files/figure-html/mollweide-1.png" width="864" /&gt;

---

# Symbols

&lt;img src="index_files/figure-html/bb-hydepark-stamen-1.png" width="864" /&gt;

---

# `ggmap`

* Package for drawing maps using `ggplot2` and **raster** map tiles
* Static image files generated by mapping services
* Focus on incorporating data into existing maps
* Severely limits ability to change the appearance of the geographic map

---

# Obtain map images

* [OpenStreetMap](https://www.openstreetmap.org/)
* [Stamen Maps](http://maps.stamen.com/#terrain/12/37.7706/-122.3782)
* [Google Maps](https://maps.google.com)

--

## Method for specifying map regions

1. Bounding box
1. Center/zoom

---

# Bounding box


```r
# store bounding box coordinates
chi_bb &lt;- c(
  left = -87.936287,
  bottom = 41.679835,
  right = -87.447052,
  top = 42.000835
)

chicago_stamen &lt;- get_stamenmap(
  bbox = chi_bb,
  zoom = 11
)
chicago_stamen
```

```
## 627x712 terrain map image from Stamen Maps. 
## See ?ggmap to plot it.
```

---

# Bounding box


```r
ggmap(chicago_stamen)
```

&lt;img src="index_files/figure-html/bb-chicago-stamen-plot-1.png" width="864" /&gt;

---

# Level of detail

&lt;img src="index_files/figure-html/bb-chicago-stamen-zoom-1.png" width="864" /&gt;

---

# Identifying bounding box

&gt; Use [bboxfinder.com](http://bboxfinder.com/#0.000000,0.000000,0.000000,0.000000) to determine the exact longitude/latitude coordinates for the bounding box you wish to obtain.

---

# Types of map tiles

&lt;img src="index_files/figure-html/stamen-maptype-1.png" width="864" /&gt;

---

# Import crime data

* City of Chicago open data portal
* [Crime data from 2017](https://data.cityofchicago.org/Public-Safety/Crimes-2017/d62x-nvdr)


```
## Observations: 267,345
## Variables: 22
## $ ID                     &lt;dbl&gt; 11094370, 11118031, 11134189, 11156462, 1…
## $ `Case Number`          &lt;chr&gt; "JA440032", "JA470589", "JA491697", "JA52…
## $ Date                   &lt;chr&gt; "09/21/2017 12:15:00 AM", "10/12/2017 07:…
## $ Block                  &lt;chr&gt; "072XX N CALIFORNIA AVE", "055XX W GRAND …
## $ IUCR                   &lt;chr&gt; "1122", "1345", "4651", "1110", "0265", "…
## $ `Primary Type`         &lt;chr&gt; "DECEPTIVE PRACTICE", "CRIMINAL DAMAGE", …
## $ Description            &lt;chr&gt; "COUNTERFEIT CHECK", "TO CITY OF CHICAGO …
## $ `Location Description` &lt;chr&gt; "CURRENCY EXCHANGE", "JAIL / LOCK-UP FACI…
## $ Arrest                 &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE,…
## $ Domestic               &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE,…
## $ Beat                   &lt;chr&gt; "2411", "2515", "0922", "2514", "1221", "…
## $ District               &lt;chr&gt; "024", "025", "009", "025", "012", "002",…
## $ Ward                   &lt;dbl&gt; 50, 29, 12, 30, 32, 20, 9, 12, 12, 27, 32…
## $ `Community Area`       &lt;dbl&gt; 2, 19, 58, 19, 24, 40, 49, 30, 30, 23, 24…
## $ `FBI Code`             &lt;chr&gt; "10", "14", "26", "11", "02", "15", "03",…
## $ `X Coordinate`         &lt;dbl&gt; 1156443, 1138788, 1159425, 1138653, 11612…
## $ `Y Coordinate`         &lt;dbl&gt; 1947707, 1913480, 1875711, 1920720, 19052…
## $ Year                   &lt;dbl&gt; 2017, 2017, 2017, 2017, 2017, 2017, 2017,…
## $ `Updated On`           &lt;chr&gt; "03/01/2018 03:52:35 PM", "03/01/2018 03:…
## $ Latitude               &lt;dbl&gt; 42.01229, 41.91871, 41.81467, 41.93858, 4…
## $ Longitude              &lt;dbl&gt; -87.69971, -87.76551, -87.69073, -87.7658…
## $ Location               &lt;chr&gt; "(42.012293397, -87.699714109)", "(41.918…
```

---

# Plot high-level map of crime

&lt;img src="index_files/figure-html/import-chicago-1.png" width="864" /&gt;

---

# Using `geom_point()`


```r
ggmap(chicago) +
  geom_point(
    data = crimes,
    mapping = aes(
      x = Longitude,
      y = Latitude
    )
  )
```

&lt;img src="index_files/figure-html/plot-crime-point-1.png" width="864" /&gt;

---

# Using `geom_point()`


```r
ggmap(chicago) +
  geom_point(
    data = crimes,
    aes(
      x = Longitude,
      y = Latitude
    ),
    size = .25,
    alpha = .01
  )
```

&lt;img src="index_files/figure-html/plot-crime-point-alpha-1.png" width="864" /&gt;

---

# Using `stat_density_2d()`


```r
ggmap(chicago) +
  geom_density_2d(
    data = crimes,
    aes(
      x = Longitude,
      y = Latitude
    )
  )
```

&lt;img src="index_files/figure-html/kde-contour-1.png" width="864" /&gt;

---

# Using `stat_density_2d()`


```r
ggmap(chicago) +
  stat_density_2d(
    data = crimes,
    aes(
      x = Longitude,
      y = Latitude,
      fill = stat(level)
    ),
    geom = "polygon"
  )
```

&lt;img src="index_files/figure-html/kde-fill-1.png" width="864" /&gt;

---

# Using `stat_density_2d()`

&lt;img src="index_files/figure-html/plot-crime-density-1.png" width="864" /&gt;

---

# Looking for variation

&lt;img src="index_files/figure-html/plot-crime-wday-1.png" width="864" /&gt;

---

# Locations of murders


```
## # A tibble: 671 x 22
##        ID `Case Number` Date  Block IUCR  `Primary Type` Description
##     &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;          &lt;chr&gt;      
##  1 2.31e4 JA149608      02/1… 001X… 0110  HOMICIDE       FIRST DEGR…
##  2 2.39e4 JA530946      11/3… 088X… 0110  HOMICIDE       FIRST DEGR…
##  3 2.34e4 JA302423      06/1… 047X… 0110  HOMICIDE       FIRST DEGR…
##  4 2.34e4 JA312425      06/1… 006X… 0110  HOMICIDE       FIRST DEGR…
##  5 2.37e4 JA490016      10/2… 048X… 0110  HOMICIDE       FIRST DEGR…
##  6 2.32e4 JA210752      04/0… 013X… 0110  HOMICIDE       FIRST DEGR…
##  7 2.36e4 JA461918      10/0… 018X… 0110  HOMICIDE       FIRST DEGR…
##  8 2.36e4 JA461918      10/0… 018X… 0110  HOMICIDE       FIRST DEGR…
##  9 1.08e7 JA138326      02/0… 013X… 0142  HOMICIDE       RECKLESS H…
## 10 2.35e4 JA364517      07/2… 047X… 0110  HOMICIDE       FIRST DEGR…
## # … with 661 more rows, and 15 more variables: `Location
## #   Description` &lt;chr&gt;, Arrest &lt;lgl&gt;, Domestic &lt;lgl&gt;, Beat &lt;chr&gt;,
## #   District &lt;chr&gt;, Ward &lt;dbl&gt;, `Community Area` &lt;dbl&gt;, `FBI Code` &lt;chr&gt;,
## #   `X Coordinate` &lt;dbl&gt;, `Y Coordinate` &lt;dbl&gt;, Year &lt;dbl&gt;, `Updated
## #   On` &lt;chr&gt;, Latitude &lt;dbl&gt;, Longitude &lt;dbl&gt;, Location &lt;chr&gt;
```

---

# Locations of murders

&lt;img src="index_files/figure-html/homicide-city-1.png" width="864" /&gt;

---

# Locations of murders



&lt;img src="index_files/figure-html/get-high-low-murder-maps-1.png" width="864" /&gt;

---

# Locations of murders

&lt;img src="index_files/figure-html/plot-murder-1.png" width="864" /&gt;

---

# Additional aesthetics



&lt;img src="index_files/figure-html/plot-violent-1.png" width="864" /&gt;


---

# Exercise using `ggmap`

![](https://pixel.nymag.com/imgs/daily/strategist/2018/09/05/schwinn-recumbent-exercise-bike.w710.h473.2x.jpg)
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="https://cfss.uchicago.edu/slides/macros.js"></script>
<script>var slideshow = remark.create({
"highlightLanguage": "r",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
